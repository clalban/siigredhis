<?php

// Data functions (insert, update, delete, form) for table historico_vt

// This script and data application were generated by AppGini 22.13
// Download AppGini for free from https://bigprof.com/appgini/download/

function historico_vt_insert(&$error_message = '') {
	global $Translation;

	// mm: can member insert record?
	$arrPerm = getTablePermissions('historico_vt');
	if(!$arrPerm['insert']) return false;

	$data = [
		'VcrCodHis' => Request::val('VcrCodHis', ''),
		'Vcrano' => Request::val('Vcrano', ''),
		'VcrIdSerP' => Request::lookup('VcrIdSerP', ''),
		'VcrIdSol' => Request::lookup('VcrIdSol', ''),
		'VcrRadSol' => Request::val('VcrRadSol', ''),
		'VcrFecSol' => Request::dateComponents('VcrFecSol', ''),
		'VcrRadRes' => Request::val('VcrRadRes', ''),
		'VcrFecRad' => Request::dateComponents('VcrFecRad', ''),
		'VcrDiaResp' => Request::val('VcrDiaResp', ''),
		'VcrIdRie' => Request::lookup('VcrIdRie', ''),
		'VcrEntSol' => Request::val('VcrEntSol', ''),
		'VcrNomAti' => Request::val('VcrNomAti', ''),
		'VcrNoIde' => Request::val('VcrNoIde', ''),
		'VcrCel' => Request::val('VcrCel', ''),
		'VcrCodForm' => Request::val('VcrCodForm', ''),
		'VcrFecVis' => Request::dateComponents('VcrFecVis', ''),
		'VcrDir' => Request::val('VcrDir', ''),
		'VcrIdBarVe' => Request::lookup('VcrIdBarVe', ''),
		'VcrIdCom' => Request::lookup('VcrIdCom', ''),
		'VcrIdCorr' => Request::lookup('VcrIdCorr', ''),
		'VcrLon' => Request::val('VcrLon', ''),
		'VcrLat' => Request::val('VcrLat', ''),
		'VcrIdMot' => Request::lookup('VcrIdMot', ''),
		'VcrIdFen' => Request::lookup('VcrIdFen', ''),
		'VcrIdCar' => Request::lookup('VcrIdCar', ''),
		'VcrAyuHum' => Request::val('VcrAyuHum', ''),
		'VcrPerHer' => Request::val('VcrPerHer', ''),
		'VcrPerFall' => Request::val('VcrPerFall', ''),
		'VcrTraCas' => Request::val('VcrTraCas', ''),
		'VcrCop' => Request::val('VcrCop', ''),
		'VcrEstTra' => br2nl(Request::val('VcrEstTra', '')),
		'VcrObsHis' => br2nl(Request::val('VcrObsHis', '')),
		'VcrUbiInf' => br2nl(Request::val('VcrUbiInf', '')),
		'VcrResInf' => br2nl(Request::val('VcrResInf', '')),
		'VcrIdTra1' => Request::lookup('VcrIdTra1', ''),
		'VcrRadTra1' => Request::val('VcrRadTra1', ''),
		'VcrFecTra1' => Request::dateComponents('VcrFecTra1', ''),
		'VcrResTra1' => br2nl(Request::val('VcrResTra1', '')),
		'VcrIdTra2' => Request::lookup('VcrIdTra2', ''),
		'VcrRadTra2' => Request::val('VcrRadTra2', ''),
		'VcrFecTra2' => Request::dateComponents('VcrFecTra2', ''),
		'VcrResTra2' => br2nl(Request::val('VcrResTra2', '')),
		'VcrIdTra3' => Request::lookup('VcrIdTra3', ''),
		'VcrRadTra3' => Request::val('VcrRadTra3', ''),
		'VcrFecTra3' => Request::dateComponents('VcrFecTra3', ''),
		'VcrResTra3' => Request::val('VcrResTra3', ''),
		'VcrIdTra4' => Request::lookup('VcrIdTra4', ''),
		'VcrRadTra4' => Request::val('VcrRadTra4', ''),
		'VcrFecTra4' => Request::dateComponents('VcrFecTra4', ''),
		'VcrResTra4' => br2nl(Request::val('VcrResTra4', '')),
		'VcrIdTra5' => Request::lookup('VcrIdTra5', ''),
		'VcrRadTra5' => Request::val('VcrRadTra5', ''),
		'VcrFecTra5' => Request::dateComponents('VcrFecTra5', ''),
		'VcrResTra5' => br2nl(Request::val('VcrResTra5', '')),
		'VcrIdTra6' => Request::lookup('VcrIdTra6', ''),
		'VcrRadTra6' => Request::val('VcrRadTra6', ''),
		'VcrIdTra7' => Request::lookup('VcrIdTra7', ''),
		'VcrRadTra7' => br2nl(Request::val('VcrRadTra7', '')),
		'VcrIdTra8' => Request::lookup('VcrIdTra8', ''),
		'VcrRadTra8' => Request::val('VcrRadTra8', ''),
	];

	if($data['VcrIdSerP'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'FUNCIONARIO / CONTRATISTA:': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['VcrIdSol'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'TIPO SOLICITUD:': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['VcrIdMot'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'MOTIVO VISITA:': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['VcrIdFen'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'TIPO DE FEN&#211;MENO:': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['VcrIdCar'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'CARACTER&#205;STICAS DEL EVENTO:': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['VcrAyuHum'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'AYUDA HUMANITARIA:': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}

	// hook: historico_vt_before_insert
	if(function_exists('historico_vt_before_insert')) {
		$args = [];
		if(!historico_vt_before_insert($data, getMemberInfo(), $args)) {
			if(isset($args['error_message'])) $error_message = $args['error_message'];
			return false;
		}
	}

	$error = '';
	// set empty fields to NULL
	$data = array_map(function($v) { return ($v === '' ? NULL : $v); }, $data);
	insert('historico_vt', backtick_keys_once($data), $error);
	if($error) {
		$error_message = $error;
		return false;
	}

	$recID = db_insert_id(db_link());

	update_calc_fields('historico_vt', $recID, calculated_fields()['historico_vt']);

	// hook: historico_vt_after_insert
	if(function_exists('historico_vt_after_insert')) {
		$res = sql("SELECT * FROM `historico_vt` WHERE `VcrId`='" . makeSafe($recID, false) . "' LIMIT 1", $eo);
		if($row = db_fetch_assoc($res)) {
			$data = array_map('makeSafe', $row);
		}
		$data['selectedID'] = makeSafe($recID, false);
		$args = [];
		if(!historico_vt_after_insert($data, getMemberInfo(), $args)) { return $recID; }
	}

	// mm: save ownership data
	set_record_owner('historico_vt', $recID, getLoggedMemberID());

	// if this record is a copy of another record, copy children if applicable
	if(strlen(Request::val('SelectedID'))) historico_vt_copy_children($recID, Request::val('SelectedID'));

	return $recID;
}

function historico_vt_copy_children($destination_id, $source_id) {
	global $Translation;
	$requests = []; // array of curl handlers for launching insert requests
	$eo = ['silentErrors' => true];
	$safe_sid = makeSafe($source_id);

	// launch requests, asynchronously
	curl_batch($requests);
}

function historico_vt_delete($selected_id, $AllowDeleteOfParents = false, $skipChecks = false) {
	// insure referential integrity ...
	global $Translation;
	$selected_id = makeSafe($selected_id);

	// mm: can member delete record?
	if(!check_record_permission('historico_vt', $selected_id, 'delete')) {
		return $Translation['You don\'t have enough permissions to delete this record'];
	}

	// hook: historico_vt_before_delete
	if(function_exists('historico_vt_before_delete')) {
		$args = [];
		if(!historico_vt_before_delete($selected_id, $skipChecks, getMemberInfo(), $args))
			return $Translation['Couldn\'t delete this record'] . (
				!empty($args['error_message']) ?
					'<div class="text-bold">' . strip_tags($args['error_message']) . '</div>'
					: '' 
			);
	}

	sql("DELETE FROM `historico_vt` WHERE `VcrId`='{$selected_id}'", $eo);

	// hook: historico_vt_after_delete
	if(function_exists('historico_vt_after_delete')) {
		$args = [];
		historico_vt_after_delete($selected_id, getMemberInfo(), $args);
	}

	// mm: delete ownership data
	sql("DELETE FROM `membership_userrecords` WHERE `tableName`='historico_vt' AND `pkValue`='{$selected_id}'", $eo);
}

function historico_vt_update(&$selected_id, &$error_message = '') {
	global $Translation;

	// mm: can member edit record?
	if(!check_record_permission('historico_vt', $selected_id, 'edit')) return false;

	$data = [
		'VcrCodHis' => Request::val('VcrCodHis', ''),
		'Vcrano' => Request::val('Vcrano', ''),
		'VcrIdSerP' => Request::lookup('VcrIdSerP', ''),
		'VcrIdSol' => Request::lookup('VcrIdSol', ''),
		'VcrRadSol' => Request::val('VcrRadSol', ''),
		'VcrFecSol' => Request::dateComponents('VcrFecSol', ''),
		'VcrRadRes' => Request::val('VcrRadRes', ''),
		'VcrFecRad' => Request::dateComponents('VcrFecRad', ''),
		'VcrDiaResp' => Request::val('VcrDiaResp', ''),
		'VcrIdRie' => Request::lookup('VcrIdRie', ''),
		'VcrEntSol' => Request::val('VcrEntSol', ''),
		'VcrNomAti' => Request::val('VcrNomAti', ''),
		'VcrNoIde' => Request::val('VcrNoIde', ''),
		'VcrCel' => Request::val('VcrCel', ''),
		'VcrCodForm' => Request::val('VcrCodForm', ''),
		'VcrFecVis' => Request::dateComponents('VcrFecVis', ''),
		'VcrDir' => Request::val('VcrDir', ''),
		'VcrIdBarVe' => Request::lookup('VcrIdBarVe', ''),
		'VcrIdCom' => Request::lookup('VcrIdCom', ''),
		'VcrIdCorr' => Request::lookup('VcrIdCorr', ''),
		'VcrLon' => Request::val('VcrLon', ''),
		'VcrLat' => Request::val('VcrLat', ''),
		'VcrIdMot' => Request::lookup('VcrIdMot', ''),
		'VcrIdFen' => Request::lookup('VcrIdFen', ''),
		'VcrIdCar' => Request::lookup('VcrIdCar', ''),
		'VcrAyuHum' => Request::val('VcrAyuHum', ''),
		'VcrPerHer' => Request::val('VcrPerHer', ''),
		'VcrPerFall' => Request::val('VcrPerFall', ''),
		'VcrTraCas' => Request::val('VcrTraCas', ''),
		'VcrCop' => Request::val('VcrCop', ''),
		'VcrEstTra' => br2nl(Request::val('VcrEstTra', '')),
		'VcrObsHis' => br2nl(Request::val('VcrObsHis', '')),
		'VcrUbiInf' => br2nl(Request::val('VcrUbiInf', '')),
		'VcrResInf' => br2nl(Request::val('VcrResInf', '')),
		'VcrIdTra1' => Request::lookup('VcrIdTra1', ''),
		'VcrRadTra1' => Request::val('VcrRadTra1', ''),
		'VcrFecTra1' => Request::dateComponents('VcrFecTra1', ''),
		'VcrResTra1' => br2nl(Request::val('VcrResTra1', '')),
		'VcrIdTra2' => Request::lookup('VcrIdTra2', ''),
		'VcrRadTra2' => Request::val('VcrRadTra2', ''),
		'VcrFecTra2' => Request::dateComponents('VcrFecTra2', ''),
		'VcrResTra2' => br2nl(Request::val('VcrResTra2', '')),
		'VcrIdTra3' => Request::lookup('VcrIdTra3', ''),
		'VcrRadTra3' => Request::val('VcrRadTra3', ''),
		'VcrFecTra3' => Request::dateComponents('VcrFecTra3', ''),
		'VcrResTra3' => Request::val('VcrResTra3', ''),
		'VcrIdTra4' => Request::lookup('VcrIdTra4', ''),
		'VcrRadTra4' => Request::val('VcrRadTra4', ''),
		'VcrFecTra4' => Request::dateComponents('VcrFecTra4', ''),
		'VcrResTra4' => br2nl(Request::val('VcrResTra4', '')),
		'VcrIdTra5' => Request::lookup('VcrIdTra5', ''),
		'VcrRadTra5' => Request::val('VcrRadTra5', ''),
		'VcrFecTra5' => Request::dateComponents('VcrFecTra5', ''),
		'VcrResTra5' => br2nl(Request::val('VcrResTra5', '')),
		'VcrIdTra6' => Request::lookup('VcrIdTra6', ''),
		'VcrRadTra6' => Request::val('VcrRadTra6', ''),
		'VcrIdTra7' => Request::lookup('VcrIdTra7', ''),
		'VcrRadTra7' => br2nl(Request::val('VcrRadTra7', '')),
		'VcrIdTra8' => Request::lookup('VcrIdTra8', ''),
		'VcrRadTra8' => Request::val('VcrRadTra8', ''),
	];

	if($data['VcrIdSerP'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'FUNCIONARIO / CONTRATISTA:': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['VcrIdSol'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'TIPO SOLICITUD:': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['VcrIdMot'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'MOTIVO VISITA:': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['VcrIdFen'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'TIPO DE FEN&#211;MENO:': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['VcrIdCar'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'CARACTER&#205;STICAS DEL EVENTO:': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	if($data['VcrAyuHum'] === '') {
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'AYUDA HUMANITARIA:': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">' . $Translation['< back'] . '</a></div>';
		exit;
	}
	// get existing values
	$old_data = getRecord('historico_vt', $selected_id);
	if(is_array($old_data)) {
		$old_data = array_map('makeSafe', $old_data);
		$old_data['selectedID'] = makeSafe($selected_id);
	}

	$data['selectedID'] = makeSafe($selected_id);

	// hook: historico_vt_before_update
	if(function_exists('historico_vt_before_update')) {
		$args = ['old_data' => $old_data];
		if(!historico_vt_before_update($data, getMemberInfo(), $args)) {
			if(isset($args['error_message'])) $error_message = $args['error_message'];
			return false;
		}
	}

	$set = $data; unset($set['selectedID']);
	foreach ($set as $field => $value) {
		$set[$field] = ($value !== '' && $value !== NULL) ? $value : NULL;
	}

	if(!update(
		'historico_vt', 
		backtick_keys_once($set), 
		['`VcrId`' => $selected_id], 
		$error_message
	)) {
		echo $error_message;
		echo '<a href="historico_vt_view.php?SelectedID=' . urlencode($selected_id) . "\">{$Translation['< back']}</a>";
		exit;
	}


	$eo = ['silentErrors' => true];

	update_calc_fields('historico_vt', $data['selectedID'], calculated_fields()['historico_vt']);

	// hook: historico_vt_after_update
	if(function_exists('historico_vt_after_update')) {
		$res = sql("SELECT * FROM `historico_vt` WHERE `VcrId`='{$data['selectedID']}' LIMIT 1", $eo);
		if($row = db_fetch_assoc($res)) $data = array_map('makeSafe', $row);

		$data['selectedID'] = $data['VcrId'];
		$args = ['old_data' => $old_data];
		if(!historico_vt_after_update($data, getMemberInfo(), $args)) return;
	}

	// mm: update ownership data
	sql("UPDATE `membership_userrecords` SET `dateUpdated`='" . time() . "' WHERE `tableName`='historico_vt' AND `pkValue`='" . makeSafe($selected_id) . "'", $eo);
}

function historico_vt_form($selected_id = '', $AllowUpdate = 1, $AllowInsert = 1, $AllowDelete = 1, $separateDV = 0, $TemplateDV = '', $TemplateDVP = '') {
	// function to return an editable form for a table records
	// and fill it with data of record whose ID is $selected_id. If $selected_id
	// is empty, an empty form is shown, with only an 'Add New'
	// button displayed.

	global $Translation;
	$eo = ['silentErrors' => true];
	$noUploads = null;
	$row = $urow = $jsReadOnly = $jsEditable = $lookups = null;

	$noSaveAsCopy = false;

	// mm: get table permissions
	$arrPerm = getTablePermissions('historico_vt');
	if(!$arrPerm['insert'] && $selected_id == '')
		// no insert permission and no record selected
		// so show access denied error unless TVDV
		return $separateDV ? $Translation['tableAccessDenied'] : '';
	$AllowInsert = ($arrPerm['insert'] ? true : false);
	// print preview?
	$dvprint = false;
	if(strlen($selected_id) && Request::val('dvprint_x') != '') {
		$dvprint = true;
	}

	$filterer_VcrIdSerP = Request::val('filterer_VcrIdSerP');
	$filterer_VcrIdSol = Request::val('filterer_VcrIdSol');
	$filterer_VcrIdRie = Request::val('filterer_VcrIdRie');
	$filterer_VcrIdBarVe = Request::val('filterer_VcrIdBarVe');
	$filterer_VcrIdCom = Request::val('filterer_VcrIdCom');
	$filterer_VcrIdCorr = Request::val('filterer_VcrIdCorr');
	$filterer_VcrIdMot = Request::val('filterer_VcrIdMot');
	$filterer_VcrIdFen = Request::val('filterer_VcrIdFen');
	$filterer_VcrIdCar = Request::val('filterer_VcrIdCar');
	$filterer_VcrIdTra1 = Request::val('filterer_VcrIdTra1');
	$filterer_VcrIdTra2 = Request::val('filterer_VcrIdTra2');
	$filterer_VcrIdTra3 = Request::val('filterer_VcrIdTra3');
	$filterer_VcrIdTra4 = Request::val('filterer_VcrIdTra4');
	$filterer_VcrIdTra5 = Request::val('filterer_VcrIdTra5');
	$filterer_VcrIdTra6 = Request::val('filterer_VcrIdTra6');
	$filterer_VcrIdTra7 = Request::val('filterer_VcrIdTra7');
	$filterer_VcrIdTra8 = Request::val('filterer_VcrIdTra8');

	// populate filterers, starting from children to grand-parents

	// unique random identifier
	$rnd1 = ($dvprint ? rand(1000000, 9999999) : '');
	// combobox: VcrIdSerP
	$combo_VcrIdSerP = new DataCombo;
	// combobox: VcrIdSol
	$combo_VcrIdSol = new DataCombo;
	// combobox: VcrFecSol
	$combo_VcrFecSol = new DateCombo;
	$combo_VcrFecSol->DateFormat = "dmy";
	$combo_VcrFecSol->MinYear = defined('historico_vt.VcrFecSol.MinYear') ? constant('historico_vt.VcrFecSol.MinYear') : 1900;
	$combo_VcrFecSol->MaxYear = defined('historico_vt.VcrFecSol.MaxYear') ? constant('historico_vt.VcrFecSol.MaxYear') : 2100;
	$combo_VcrFecSol->DefaultDate = parseMySQLDate('', '');
	$combo_VcrFecSol->MonthNames = $Translation['month names'];
	$combo_VcrFecSol->NamePrefix = 'VcrFecSol';
	// combobox: VcrFecRad
	$combo_VcrFecRad = new DateCombo;
	$combo_VcrFecRad->DateFormat = "dmy";
	$combo_VcrFecRad->MinYear = defined('historico_vt.VcrFecRad.MinYear') ? constant('historico_vt.VcrFecRad.MinYear') : 1900;
	$combo_VcrFecRad->MaxYear = defined('historico_vt.VcrFecRad.MaxYear') ? constant('historico_vt.VcrFecRad.MaxYear') : 2100;
	$combo_VcrFecRad->DefaultDate = parseMySQLDate('', '');
	$combo_VcrFecRad->MonthNames = $Translation['month names'];
	$combo_VcrFecRad->NamePrefix = 'VcrFecRad';
	// combobox: VcrIdRie
	$combo_VcrIdRie = new DataCombo;
	// combobox: VcrFecVis
	$combo_VcrFecVis = new DateCombo;
	$combo_VcrFecVis->DateFormat = "dmy";
	$combo_VcrFecVis->MinYear = defined('historico_vt.VcrFecVis.MinYear') ? constant('historico_vt.VcrFecVis.MinYear') : 1900;
	$combo_VcrFecVis->MaxYear = defined('historico_vt.VcrFecVis.MaxYear') ? constant('historico_vt.VcrFecVis.MaxYear') : 2100;
	$combo_VcrFecVis->DefaultDate = parseMySQLDate('', '');
	$combo_VcrFecVis->MonthNames = $Translation['month names'];
	$combo_VcrFecVis->NamePrefix = 'VcrFecVis';
	// combobox: VcrIdBarVe
	$combo_VcrIdBarVe = new DataCombo;
	// combobox: VcrIdCom
	$combo_VcrIdCom = new DataCombo;
	// combobox: VcrIdCorr
	$combo_VcrIdCorr = new DataCombo;
	// combobox: VcrIdMot
	$combo_VcrIdMot = new DataCombo;
	// combobox: VcrIdFen
	$combo_VcrIdFen = new DataCombo;
	// combobox: VcrIdCar
	$combo_VcrIdCar = new DataCombo;
	// combobox: VcrAyuHum
	$combo_VcrAyuHum = new Combo;
	$combo_VcrAyuHum->ListType = 0;
	$combo_VcrAyuHum->MultipleSeparator = ', ';
	$combo_VcrAyuHum->ListBoxHeight = 10;
	$combo_VcrAyuHum->RadiosPerLine = 1;
	if(is_file(__DIR__ . '/hooks/historico_vt.VcrAyuHum.csv')) {
		$VcrAyuHum_data = addslashes(implode('', @file(__DIR__ . '/hooks/historico_vt.VcrAyuHum.csv')));
		$combo_VcrAyuHum->ListItem = array_trim(explode('||', entitiesToUTF8(convertLegacyOptions($VcrAyuHum_data))));
		$combo_VcrAyuHum->ListData = $combo_VcrAyuHum->ListItem;
	} else {
		$combo_VcrAyuHum->ListItem = array_trim(explode('||', entitiesToUTF8(convertLegacyOptions("NO;;SI"))));
		$combo_VcrAyuHum->ListData = $combo_VcrAyuHum->ListItem;
	}
	$combo_VcrAyuHum->SelectName = 'VcrAyuHum';
	$combo_VcrAyuHum->AllowNull = false;
	// combobox: VcrPerHer
	$combo_VcrPerHer = new Combo;
	$combo_VcrPerHer->ListType = 0;
	$combo_VcrPerHer->MultipleSeparator = ', ';
	$combo_VcrPerHer->ListBoxHeight = 10;
	$combo_VcrPerHer->RadiosPerLine = 1;
	if(is_file(__DIR__ . '/hooks/historico_vt.VcrPerHer.csv')) {
		$VcrPerHer_data = addslashes(implode('', @file(__DIR__ . '/hooks/historico_vt.VcrPerHer.csv')));
		$combo_VcrPerHer->ListItem = array_trim(explode('||', entitiesToUTF8(convertLegacyOptions($VcrPerHer_data))));
		$combo_VcrPerHer->ListData = $combo_VcrPerHer->ListItem;
	} else {
		$combo_VcrPerHer->ListItem = array_trim(explode('||', entitiesToUTF8(convertLegacyOptions("NO;;SI"))));
		$combo_VcrPerHer->ListData = $combo_VcrPerHer->ListItem;
	}
	$combo_VcrPerHer->SelectName = 'VcrPerHer';
	// combobox: VcrPerFall
	$combo_VcrPerFall = new Combo;
	$combo_VcrPerFall->ListType = 0;
	$combo_VcrPerFall->MultipleSeparator = ', ';
	$combo_VcrPerFall->ListBoxHeight = 10;
	$combo_VcrPerFall->RadiosPerLine = 1;
	if(is_file(__DIR__ . '/hooks/historico_vt.VcrPerFall.csv')) {
		$VcrPerFall_data = addslashes(implode('', @file(__DIR__ . '/hooks/historico_vt.VcrPerFall.csv')));
		$combo_VcrPerFall->ListItem = array_trim(explode('||', entitiesToUTF8(convertLegacyOptions($VcrPerFall_data))));
		$combo_VcrPerFall->ListData = $combo_VcrPerFall->ListItem;
	} else {
		$combo_VcrPerFall->ListItem = array_trim(explode('||', entitiesToUTF8(convertLegacyOptions("NO;;SI"))));
		$combo_VcrPerFall->ListData = $combo_VcrPerFall->ListItem;
	}
	$combo_VcrPerFall->SelectName = 'VcrPerFall';
	// combobox: VcrTraCas
	$combo_VcrTraCas = new Combo;
	$combo_VcrTraCas->ListType = 0;
	$combo_VcrTraCas->MultipleSeparator = ', ';
	$combo_VcrTraCas->ListBoxHeight = 10;
	$combo_VcrTraCas->RadiosPerLine = 1;
	if(is_file(__DIR__ . '/hooks/historico_vt.VcrTraCas.csv')) {
		$VcrTraCas_data = addslashes(implode('', @file(__DIR__ . '/hooks/historico_vt.VcrTraCas.csv')));
		$combo_VcrTraCas->ListItem = array_trim(explode('||', entitiesToUTF8(convertLegacyOptions($VcrTraCas_data))));
		$combo_VcrTraCas->ListData = $combo_VcrTraCas->ListItem;
	} else {
		$combo_VcrTraCas->ListItem = array_trim(explode('||', entitiesToUTF8(convertLegacyOptions("NO;;SI"))));
		$combo_VcrTraCas->ListData = $combo_VcrTraCas->ListItem;
	}
	$combo_VcrTraCas->SelectName = 'VcrTraCas';
	// combobox: VcrIdTra1
	$combo_VcrIdTra1 = new DataCombo;
	// combobox: VcrFecTra1
	$combo_VcrFecTra1 = new DateCombo;
	$combo_VcrFecTra1->DateFormat = "dmy";
	$combo_VcrFecTra1->MinYear = defined('historico_vt.VcrFecTra1.MinYear') ? constant('historico_vt.VcrFecTra1.MinYear') : 1900;
	$combo_VcrFecTra1->MaxYear = defined('historico_vt.VcrFecTra1.MaxYear') ? constant('historico_vt.VcrFecTra1.MaxYear') : 2100;
	$combo_VcrFecTra1->DefaultDate = parseMySQLDate('', '');
	$combo_VcrFecTra1->MonthNames = $Translation['month names'];
	$combo_VcrFecTra1->NamePrefix = 'VcrFecTra1';
	// combobox: VcrIdTra2
	$combo_VcrIdTra2 = new DataCombo;
	// combobox: VcrFecTra2
	$combo_VcrFecTra2 = new DateCombo;
	$combo_VcrFecTra2->DateFormat = "dmy";
	$combo_VcrFecTra2->MinYear = defined('historico_vt.VcrFecTra2.MinYear') ? constant('historico_vt.VcrFecTra2.MinYear') : 1900;
	$combo_VcrFecTra2->MaxYear = defined('historico_vt.VcrFecTra2.MaxYear') ? constant('historico_vt.VcrFecTra2.MaxYear') : 2100;
	$combo_VcrFecTra2->DefaultDate = parseMySQLDate('', '');
	$combo_VcrFecTra2->MonthNames = $Translation['month names'];
	$combo_VcrFecTra2->NamePrefix = 'VcrFecTra2';
	// combobox: VcrIdTra3
	$combo_VcrIdTra3 = new DataCombo;
	// combobox: VcrFecTra3
	$combo_VcrFecTra3 = new DateCombo;
	$combo_VcrFecTra3->DateFormat = "dmy";
	$combo_VcrFecTra3->MinYear = defined('historico_vt.VcrFecTra3.MinYear') ? constant('historico_vt.VcrFecTra3.MinYear') : 1900;
	$combo_VcrFecTra3->MaxYear = defined('historico_vt.VcrFecTra3.MaxYear') ? constant('historico_vt.VcrFecTra3.MaxYear') : 2100;
	$combo_VcrFecTra3->DefaultDate = parseMySQLDate('', '');
	$combo_VcrFecTra3->MonthNames = $Translation['month names'];
	$combo_VcrFecTra3->NamePrefix = 'VcrFecTra3';
	// combobox: VcrIdTra4
	$combo_VcrIdTra4 = new DataCombo;
	// combobox: VcrFecTra4
	$combo_VcrFecTra4 = new DateCombo;
	$combo_VcrFecTra4->DateFormat = "dmy";
	$combo_VcrFecTra4->MinYear = defined('historico_vt.VcrFecTra4.MinYear') ? constant('historico_vt.VcrFecTra4.MinYear') : 1900;
	$combo_VcrFecTra4->MaxYear = defined('historico_vt.VcrFecTra4.MaxYear') ? constant('historico_vt.VcrFecTra4.MaxYear') : 2100;
	$combo_VcrFecTra4->DefaultDate = parseMySQLDate('', '');
	$combo_VcrFecTra4->MonthNames = $Translation['month names'];
	$combo_VcrFecTra4->NamePrefix = 'VcrFecTra4';
	// combobox: VcrIdTra5
	$combo_VcrIdTra5 = new DataCombo;
	// combobox: VcrFecTra5
	$combo_VcrFecTra5 = new DateCombo;
	$combo_VcrFecTra5->DateFormat = "dmy";
	$combo_VcrFecTra5->MinYear = defined('historico_vt.VcrFecTra5.MinYear') ? constant('historico_vt.VcrFecTra5.MinYear') : 1900;
	$combo_VcrFecTra5->MaxYear = defined('historico_vt.VcrFecTra5.MaxYear') ? constant('historico_vt.VcrFecTra5.MaxYear') : 2100;
	$combo_VcrFecTra5->DefaultDate = parseMySQLDate('', '');
	$combo_VcrFecTra5->MonthNames = $Translation['month names'];
	$combo_VcrFecTra5->NamePrefix = 'VcrFecTra5';
	// combobox: VcrIdTra6
	$combo_VcrIdTra6 = new DataCombo;
	// combobox: VcrIdTra7
	$combo_VcrIdTra7 = new DataCombo;
	// combobox: VcrIdTra8
	$combo_VcrIdTra8 = new DataCombo;

	if($selected_id) {
		// mm: check member permissions
		if(!$arrPerm['view']) return $Translation['tableAccessDenied'];

		// mm: who is the owner?
		$ownerGroupID = sqlValue("SELECT `groupID` FROM `membership_userrecords` WHERE `tableName`='historico_vt' AND `pkValue`='" . makeSafe($selected_id) . "'");
		$ownerMemberID = sqlValue("SELECT LCASE(`memberID`) FROM `membership_userrecords` WHERE `tableName`='historico_vt' AND `pkValue`='" . makeSafe($selected_id) . "'");

		if($arrPerm['view'] == 1 && getLoggedMemberID() != $ownerMemberID) return $Translation['tableAccessDenied'];
		if($arrPerm['view'] == 2 && getLoggedGroupID() != $ownerGroupID) return $Translation['tableAccessDenied'];

		// can edit?
		$AllowUpdate = 0;
		if(($arrPerm['edit'] == 1 && $ownerMemberID == getLoggedMemberID()) || ($arrPerm['edit'] == 2 && $ownerGroupID == getLoggedGroupID()) || $arrPerm['edit'] == 3) {
			$AllowUpdate = 1;
		}

		$res = sql("SELECT * FROM `historico_vt` WHERE `VcrId`='" . makeSafe($selected_id) . "'", $eo);
		if(!($row = db_fetch_array($res))) {
			return error_message($Translation['No records found'], 'historico_vt_view.php', false);
		}
		$combo_VcrIdSerP->SelectedData = $row['VcrIdSerP'];
		$combo_VcrIdSol->SelectedData = $row['VcrIdSol'];
		$combo_VcrFecSol->DefaultDate = $row['VcrFecSol'];
		$combo_VcrFecRad->DefaultDate = $row['VcrFecRad'];
		$combo_VcrIdRie->SelectedData = $row['VcrIdRie'];
		$combo_VcrFecVis->DefaultDate = $row['VcrFecVis'];
		$combo_VcrIdBarVe->SelectedData = $row['VcrIdBarVe'];
		$combo_VcrIdCom->SelectedData = $row['VcrIdCom'];
		$combo_VcrIdCorr->SelectedData = $row['VcrIdCorr'];
		$combo_VcrIdMot->SelectedData = $row['VcrIdMot'];
		$combo_VcrIdFen->SelectedData = $row['VcrIdFen'];
		$combo_VcrIdCar->SelectedData = $row['VcrIdCar'];
		$combo_VcrAyuHum->SelectedData = $row['VcrAyuHum'];
		$combo_VcrPerHer->SelectedData = $row['VcrPerHer'];
		$combo_VcrPerFall->SelectedData = $row['VcrPerFall'];
		$combo_VcrTraCas->SelectedData = $row['VcrTraCas'];
		$combo_VcrIdTra1->SelectedData = $row['VcrIdTra1'];
		$combo_VcrFecTra1->DefaultDate = $row['VcrFecTra1'];
		$combo_VcrIdTra2->SelectedData = $row['VcrIdTra2'];
		$combo_VcrFecTra2->DefaultDate = $row['VcrFecTra2'];
		$combo_VcrIdTra3->SelectedData = $row['VcrIdTra3'];
		$combo_VcrFecTra3->DefaultDate = $row['VcrFecTra3'];
		$combo_VcrIdTra4->SelectedData = $row['VcrIdTra4'];
		$combo_VcrFecTra4->DefaultDate = $row['VcrFecTra4'];
		$combo_VcrIdTra5->SelectedData = $row['VcrIdTra5'];
		$combo_VcrFecTra5->DefaultDate = $row['VcrFecTra5'];
		$combo_VcrIdTra6->SelectedData = $row['VcrIdTra6'];
		$combo_VcrIdTra7->SelectedData = $row['VcrIdTra7'];
		$combo_VcrIdTra8->SelectedData = $row['VcrIdTra8'];
		$urow = $row; /* unsanitized data */
		$row = array_map('safe_html', $row);
	} else {
		$filterField = Request::val('FilterField');
		$filterOperator = Request::val('FilterOperator');
		$filterValue = Request::val('FilterValue');
		$combo_VcrIdSerP->SelectedData = $filterer_VcrIdSerP;
		$combo_VcrIdSol->SelectedData = $filterer_VcrIdSol;
		$combo_VcrIdRie->SelectedData = $filterer_VcrIdRie;
		$combo_VcrIdBarVe->SelectedData = $filterer_VcrIdBarVe;
		$combo_VcrIdCom->SelectedData = $filterer_VcrIdCom;
		$combo_VcrIdCorr->SelectedData = $filterer_VcrIdCorr;
		$combo_VcrIdMot->SelectedData = $filterer_VcrIdMot;
		$combo_VcrIdFen->SelectedData = $filterer_VcrIdFen;
		$combo_VcrIdCar->SelectedData = $filterer_VcrIdCar;
		$combo_VcrAyuHum->SelectedText = (isset($filterField[1]) && $filterField[1] == '27' && $filterOperator[1] == '<=>' ? $filterValue[1] : '');
		$combo_VcrPerHer->SelectedText = (isset($filterField[1]) && $filterField[1] == '28' && $filterOperator[1] == '<=>' ? $filterValue[1] : '');
		$combo_VcrPerFall->SelectedText = (isset($filterField[1]) && $filterField[1] == '29' && $filterOperator[1] == '<=>' ? $filterValue[1] : '');
		$combo_VcrTraCas->SelectedText = (isset($filterField[1]) && $filterField[1] == '30' && $filterOperator[1] == '<=>' ? $filterValue[1] : '');
		$combo_VcrIdTra1->SelectedData = $filterer_VcrIdTra1;
		$combo_VcrIdTra2->SelectedData = $filterer_VcrIdTra2;
		$combo_VcrIdTra3->SelectedData = $filterer_VcrIdTra3;
		$combo_VcrIdTra4->SelectedData = $filterer_VcrIdTra4;
		$combo_VcrIdTra5->SelectedData = $filterer_VcrIdTra5;
		$combo_VcrIdTra6->SelectedData = $filterer_VcrIdTra6;
		$combo_VcrIdTra7->SelectedData = $filterer_VcrIdTra7;
		$combo_VcrIdTra8->SelectedData = $filterer_VcrIdTra8;
	}
	$combo_VcrIdSerP->HTML = '<span id="VcrIdSerP-container' . $rnd1 . '"></span><input type="hidden" name="VcrIdSerP" id="VcrIdSerP' . $rnd1 . '" value="' . html_attr($combo_VcrIdSerP->SelectedData) . '">';
	$combo_VcrIdSerP->MatchText = '<span id="VcrIdSerP-container-readonly' . $rnd1 . '"></span><input type="hidden" name="VcrIdSerP" id="VcrIdSerP' . $rnd1 . '" value="' . html_attr($combo_VcrIdSerP->SelectedData) . '">';
	$combo_VcrIdSol->HTML = '<span id="VcrIdSol-container' . $rnd1 . '"></span><input type="hidden" name="VcrIdSol" id="VcrIdSol' . $rnd1 . '" value="' . html_attr($combo_VcrIdSol->SelectedData) . '">';
	$combo_VcrIdSol->MatchText = '<span id="VcrIdSol-container-readonly' . $rnd1 . '"></span><input type="hidden" name="VcrIdSol" id="VcrIdSol' . $rnd1 . '" value="' . html_attr($combo_VcrIdSol->SelectedData) . '">';
	$combo_VcrIdRie->HTML = '<span id="VcrIdRie-container' . $rnd1 . '"></span><input type="hidden" name="VcrIdRie" id="VcrIdRie' . $rnd1 . '" value="' . html_attr($combo_VcrIdRie->SelectedData) . '">';
	$combo_VcrIdRie->MatchText = '<span id="VcrIdRie-container-readonly' . $rnd1 . '"></span><input type="hidden" name="VcrIdRie" id="VcrIdRie' . $rnd1 . '" value="' . html_attr($combo_VcrIdRie->SelectedData) . '">';
	$combo_VcrIdBarVe->HTML = '<span id="VcrIdBarVe-container' . $rnd1 . '"></span><input type="hidden" name="VcrIdBarVe" id="VcrIdBarVe' . $rnd1 . '" value="' . html_attr($combo_VcrIdBarVe->SelectedData) . '">';
	$combo_VcrIdBarVe->MatchText = '<span id="VcrIdBarVe-container-readonly' . $rnd1 . '"></span><input type="hidden" name="VcrIdBarVe" id="VcrIdBarVe' . $rnd1 . '" value="' . html_attr($combo_VcrIdBarVe->SelectedData) . '">';
	$combo_VcrIdCom->HTML = '<span id="VcrIdCom-container' . $rnd1 . '"></span><input type="hidden" name="VcrIdCom" id="VcrIdCom' . $rnd1 . '" value="' . html_attr($combo_VcrIdCom->SelectedData) . '">';
	$combo_VcrIdCom->MatchText = '<span id="VcrIdCom-container-readonly' . $rnd1 . '"></span><input type="hidden" name="VcrIdCom" id="VcrIdCom' . $rnd1 . '" value="' . html_attr($combo_VcrIdCom->SelectedData) . '">';
	$combo_VcrIdCorr->HTML = '<span id="VcrIdCorr-container' . $rnd1 . '"></span><input type="hidden" name="VcrIdCorr" id="VcrIdCorr' . $rnd1 . '" value="' . html_attr($combo_VcrIdCorr->SelectedData) . '">';
	$combo_VcrIdCorr->MatchText = '<span id="VcrIdCorr-container-readonly' . $rnd1 . '"></span><input type="hidden" name="VcrIdCorr" id="VcrIdCorr' . $rnd1 . '" value="' . html_attr($combo_VcrIdCorr->SelectedData) . '">';
	$combo_VcrIdMot->HTML = '<span id="VcrIdMot-container' . $rnd1 . '"></span><input type="hidden" name="VcrIdMot" id="VcrIdMot' . $rnd1 . '" value="' . html_attr($combo_VcrIdMot->SelectedData) . '">';
	$combo_VcrIdMot->MatchText = '<span id="VcrIdMot-container-readonly' . $rnd1 . '"></span><input type="hidden" name="VcrIdMot" id="VcrIdMot' . $rnd1 . '" value="' . html_attr($combo_VcrIdMot->SelectedData) . '">';
	$combo_VcrIdFen->HTML = '<span id="VcrIdFen-container' . $rnd1 . '"></span><input type="hidden" name="VcrIdFen" id="VcrIdFen' . $rnd1 . '" value="' . html_attr($combo_VcrIdFen->SelectedData) . '">';
	$combo_VcrIdFen->MatchText = '<span id="VcrIdFen-container-readonly' . $rnd1 . '"></span><input type="hidden" name="VcrIdFen" id="VcrIdFen' . $rnd1 . '" value="' . html_attr($combo_VcrIdFen->SelectedData) . '">';
	$combo_VcrIdCar->HTML = '<span id="VcrIdCar-container' . $rnd1 . '"></span><input type="hidden" name="VcrIdCar" id="VcrIdCar' . $rnd1 . '" value="' . html_attr($combo_VcrIdCar->SelectedData) . '">';
	$combo_VcrIdCar->MatchText = '<span id="VcrIdCar-container-readonly' . $rnd1 . '"></span><input type="hidden" name="VcrIdCar" id="VcrIdCar' . $rnd1 . '" value="' . html_attr($combo_VcrIdCar->SelectedData) . '">';
	$combo_VcrAyuHum->Render();
	$combo_VcrPerHer->Render();
	$combo_VcrPerFall->Render();
	$combo_VcrTraCas->Render();
	$combo_VcrIdTra1->HTML = '<span id="VcrIdTra1-container' . $rnd1 . '"></span><input type="hidden" name="VcrIdTra1" id="VcrIdTra1' . $rnd1 . '" value="' . html_attr($combo_VcrIdTra1->SelectedData) . '">';
	$combo_VcrIdTra1->MatchText = '<span id="VcrIdTra1-container-readonly' . $rnd1 . '"></span><input type="hidden" name="VcrIdTra1" id="VcrIdTra1' . $rnd1 . '" value="' . html_attr($combo_VcrIdTra1->SelectedData) . '">';
	$combo_VcrIdTra2->HTML = '<span id="VcrIdTra2-container' . $rnd1 . '"></span><input type="hidden" name="VcrIdTra2" id="VcrIdTra2' . $rnd1 . '" value="' . html_attr($combo_VcrIdTra2->SelectedData) . '">';
	$combo_VcrIdTra2->MatchText = '<span id="VcrIdTra2-container-readonly' . $rnd1 . '"></span><input type="hidden" name="VcrIdTra2" id="VcrIdTra2' . $rnd1 . '" value="' . html_attr($combo_VcrIdTra2->SelectedData) . '">';
	$combo_VcrIdTra3->HTML = '<span id="VcrIdTra3-container' . $rnd1 . '"></span><input type="hidden" name="VcrIdTra3" id="VcrIdTra3' . $rnd1 . '" value="' . html_attr($combo_VcrIdTra3->SelectedData) . '">';
	$combo_VcrIdTra3->MatchText = '<span id="VcrIdTra3-container-readonly' . $rnd1 . '"></span><input type="hidden" name="VcrIdTra3" id="VcrIdTra3' . $rnd1 . '" value="' . html_attr($combo_VcrIdTra3->SelectedData) . '">';
	$combo_VcrIdTra4->HTML = '<span id="VcrIdTra4-container' . $rnd1 . '"></span><input type="hidden" name="VcrIdTra4" id="VcrIdTra4' . $rnd1 . '" value="' . html_attr($combo_VcrIdTra4->SelectedData) . '">';
	$combo_VcrIdTra4->MatchText = '<span id="VcrIdTra4-container-readonly' . $rnd1 . '"></span><input type="hidden" name="VcrIdTra4" id="VcrIdTra4' . $rnd1 . '" value="' . html_attr($combo_VcrIdTra4->SelectedData) . '">';
	$combo_VcrIdTra5->HTML = '<span id="VcrIdTra5-container' . $rnd1 . '"></span><input type="hidden" name="VcrIdTra5" id="VcrIdTra5' . $rnd1 . '" value="' . html_attr($combo_VcrIdTra5->SelectedData) . '">';
	$combo_VcrIdTra5->MatchText = '<span id="VcrIdTra5-container-readonly' . $rnd1 . '"></span><input type="hidden" name="VcrIdTra5" id="VcrIdTra5' . $rnd1 . '" value="' . html_attr($combo_VcrIdTra5->SelectedData) . '">';
	$combo_VcrIdTra6->HTML = '<span id="VcrIdTra6-container' . $rnd1 . '"></span><input type="hidden" name="VcrIdTra6" id="VcrIdTra6' . $rnd1 . '" value="' . html_attr($combo_VcrIdTra6->SelectedData) . '">';
	$combo_VcrIdTra6->MatchText = '<span id="VcrIdTra6-container-readonly' . $rnd1 . '"></span><input type="hidden" name="VcrIdTra6" id="VcrIdTra6' . $rnd1 . '" value="' . html_attr($combo_VcrIdTra6->SelectedData) . '">';
	$combo_VcrIdTra7->HTML = '<span id="VcrIdTra7-container' . $rnd1 . '"></span><input type="hidden" name="VcrIdTra7" id="VcrIdTra7' . $rnd1 . '" value="' . html_attr($combo_VcrIdTra7->SelectedData) . '">';
	$combo_VcrIdTra7->MatchText = '<span id="VcrIdTra7-container-readonly' . $rnd1 . '"></span><input type="hidden" name="VcrIdTra7" id="VcrIdTra7' . $rnd1 . '" value="' . html_attr($combo_VcrIdTra7->SelectedData) . '">';
	$combo_VcrIdTra8->HTML = '<span id="VcrIdTra8-container' . $rnd1 . '"></span><input type="hidden" name="VcrIdTra8" id="VcrIdTra8' . $rnd1 . '" value="' . html_attr($combo_VcrIdTra8->SelectedData) . '">';
	$combo_VcrIdTra8->MatchText = '<span id="VcrIdTra8-container-readonly' . $rnd1 . '"></span><input type="hidden" name="VcrIdTra8" id="VcrIdTra8' . $rnd1 . '" value="' . html_attr($combo_VcrIdTra8->SelectedData) . '">';

	ob_start();
	?>

	<script>
		// initial lookup values
		AppGini.current_VcrIdSerP__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['VcrIdSerP'] : htmlspecialchars($filterer_VcrIdSerP, ENT_QUOTES)); ?>"};
		AppGini.current_VcrIdSol__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['VcrIdSol'] : htmlspecialchars($filterer_VcrIdSol, ENT_QUOTES)); ?>"};
		AppGini.current_VcrIdRie__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['VcrIdRie'] : htmlspecialchars($filterer_VcrIdRie, ENT_QUOTES)); ?>"};
		AppGini.current_VcrIdBarVe__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['VcrIdBarVe'] : htmlspecialchars($filterer_VcrIdBarVe, ENT_QUOTES)); ?>"};
		AppGini.current_VcrIdCom__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['VcrIdCom'] : htmlspecialchars($filterer_VcrIdCom, ENT_QUOTES)); ?>"};
		AppGini.current_VcrIdCorr__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['VcrIdCorr'] : htmlspecialchars($filterer_VcrIdCorr, ENT_QUOTES)); ?>"};
		AppGini.current_VcrIdMot__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['VcrIdMot'] : htmlspecialchars($filterer_VcrIdMot, ENT_QUOTES)); ?>"};
		AppGini.current_VcrIdFen__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['VcrIdFen'] : htmlspecialchars($filterer_VcrIdFen, ENT_QUOTES)); ?>"};
		AppGini.current_VcrIdCar__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['VcrIdCar'] : htmlspecialchars($filterer_VcrIdCar, ENT_QUOTES)); ?>"};
		AppGini.current_VcrIdTra1__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['VcrIdTra1'] : htmlspecialchars($filterer_VcrIdTra1, ENT_QUOTES)); ?>"};
		AppGini.current_VcrIdTra2__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['VcrIdTra2'] : htmlspecialchars($filterer_VcrIdTra2, ENT_QUOTES)); ?>"};
		AppGini.current_VcrIdTra3__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['VcrIdTra3'] : htmlspecialchars($filterer_VcrIdTra3, ENT_QUOTES)); ?>"};
		AppGini.current_VcrIdTra4__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['VcrIdTra4'] : htmlspecialchars($filterer_VcrIdTra4, ENT_QUOTES)); ?>"};
		AppGini.current_VcrIdTra5__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['VcrIdTra5'] : htmlspecialchars($filterer_VcrIdTra5, ENT_QUOTES)); ?>"};
		AppGini.current_VcrIdTra6__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['VcrIdTra6'] : htmlspecialchars($filterer_VcrIdTra6, ENT_QUOTES)); ?>"};
		AppGini.current_VcrIdTra7__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['VcrIdTra7'] : htmlspecialchars($filterer_VcrIdTra7, ENT_QUOTES)); ?>"};
		AppGini.current_VcrIdTra8__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['VcrIdTra8'] : htmlspecialchars($filterer_VcrIdTra8, ENT_QUOTES)); ?>"};

		jQuery(function() {
			setTimeout(function() {
				if(typeof(VcrIdSerP_reload__RAND__) == 'function') VcrIdSerP_reload__RAND__();
				if(typeof(VcrIdSol_reload__RAND__) == 'function') VcrIdSol_reload__RAND__();
				if(typeof(VcrIdRie_reload__RAND__) == 'function') VcrIdRie_reload__RAND__();
				if(typeof(VcrIdBarVe_reload__RAND__) == 'function') VcrIdBarVe_reload__RAND__();
				if(typeof(VcrIdCom_reload__RAND__) == 'function') VcrIdCom_reload__RAND__();
				if(typeof(VcrIdCorr_reload__RAND__) == 'function') VcrIdCorr_reload__RAND__();
				if(typeof(VcrIdMot_reload__RAND__) == 'function') VcrIdMot_reload__RAND__();
				if(typeof(VcrIdFen_reload__RAND__) == 'function') VcrIdFen_reload__RAND__();
				if(typeof(VcrIdCar_reload__RAND__) == 'function') VcrIdCar_reload__RAND__();
				if(typeof(VcrIdTra1_reload__RAND__) == 'function') VcrIdTra1_reload__RAND__();
				if(typeof(VcrIdTra2_reload__RAND__) == 'function') VcrIdTra2_reload__RAND__();
				if(typeof(VcrIdTra3_reload__RAND__) == 'function') VcrIdTra3_reload__RAND__();
				if(typeof(VcrIdTra4_reload__RAND__) == 'function') VcrIdTra4_reload__RAND__();
				if(typeof(VcrIdTra5_reload__RAND__) == 'function') VcrIdTra5_reload__RAND__();
				if(typeof(VcrIdTra6_reload__RAND__) == 'function') VcrIdTra6_reload__RAND__();
				if(typeof(VcrIdTra7_reload__RAND__) == 'function') VcrIdTra7_reload__RAND__();
				if(typeof(VcrIdTra8_reload__RAND__) == 'function') VcrIdTra8_reload__RAND__();
			}, 50); /* we need to slightly delay client-side execution of the above code to allow AppGini.ajaxCache to work */
		});
		function VcrIdSerP_reload__RAND__() {
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint) { ?>

			$j("#VcrIdSerP-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c) {
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { id: AppGini.current_VcrIdSerP__RAND__.value, t: 'historico_vt', f: 'VcrIdSerP' },
						success: function(resp) {
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="VcrIdSerP"]').val(resp.results[0].id);
							$j('[id=VcrIdSerP-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdSerP-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=servidor_publico_view_parent]').hide(); } else { $j('.btn[id=servidor_publico_view_parent]').show(); }


							if(typeof(VcrIdSerP_update_autofills__RAND__) == 'function') VcrIdSerP_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term) { return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page) { return { s: term, p: page, t: 'historico_vt', f: 'VcrIdSerP' }; },
					results: function(resp, page) { return resp; }
				},
				escapeMarkup: function(str) { return str; }
			}).on('change', function(e) {
				AppGini.current_VcrIdSerP__RAND__.value = e.added.id;
				AppGini.current_VcrIdSerP__RAND__.text = e.added.text;
				$j('[name="VcrIdSerP"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=servidor_publico_view_parent]').hide(); } else { $j('.btn[id=servidor_publico_view_parent]').show(); }


				if(typeof(VcrIdSerP_update_autofills__RAND__) == 'function') VcrIdSerP_update_autofills__RAND__();
			});

			if(!$j("#VcrIdSerP-container__RAND__").length) {
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_VcrIdSerP__RAND__.value, t: 'historico_vt', f: 'VcrIdSerP' },
					success: function(resp) {
						$j('[name="VcrIdSerP"]').val(resp.results[0].id);
						$j('[id=VcrIdSerP-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdSerP-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=servidor_publico_view_parent]').hide(); } else { $j('.btn[id=servidor_publico_view_parent]').show(); }

						if(typeof(VcrIdSerP_update_autofills__RAND__) == 'function') VcrIdSerP_update_autofills__RAND__();
					}
				});
			}

		<?php } else { ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_VcrIdSerP__RAND__.value, t: 'historico_vt', f: 'VcrIdSerP' },
				success: function(resp) {
					$j('[id=VcrIdSerP-container__RAND__], [id=VcrIdSerP-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdSerP-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=servidor_publico_view_parent]').hide(); } else { $j('.btn[id=servidor_publico_view_parent]').show(); }

					if(typeof(VcrIdSerP_update_autofills__RAND__) == 'function') VcrIdSerP_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function VcrIdSol_reload__RAND__() {
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint) { ?>

			$j("#VcrIdSol-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c) {
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { id: AppGini.current_VcrIdSol__RAND__.value, t: 'historico_vt', f: 'VcrIdSol' },
						success: function(resp) {
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="VcrIdSol"]').val(resp.results[0].id);
							$j('[id=VcrIdSol-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdSol-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=solicitudes_view_parent]').hide(); } else { $j('.btn[id=solicitudes_view_parent]').show(); }


							if(typeof(VcrIdSol_update_autofills__RAND__) == 'function') VcrIdSol_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term) { return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page) { return { s: term, p: page, t: 'historico_vt', f: 'VcrIdSol' }; },
					results: function(resp, page) { return resp; }
				},
				escapeMarkup: function(str) { return str; }
			}).on('change', function(e) {
				AppGini.current_VcrIdSol__RAND__.value = e.added.id;
				AppGini.current_VcrIdSol__RAND__.text = e.added.text;
				$j('[name="VcrIdSol"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=solicitudes_view_parent]').hide(); } else { $j('.btn[id=solicitudes_view_parent]').show(); }


				if(typeof(VcrIdSol_update_autofills__RAND__) == 'function') VcrIdSol_update_autofills__RAND__();
			});

			if(!$j("#VcrIdSol-container__RAND__").length) {
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_VcrIdSol__RAND__.value, t: 'historico_vt', f: 'VcrIdSol' },
					success: function(resp) {
						$j('[name="VcrIdSol"]').val(resp.results[0].id);
						$j('[id=VcrIdSol-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdSol-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=solicitudes_view_parent]').hide(); } else { $j('.btn[id=solicitudes_view_parent]').show(); }

						if(typeof(VcrIdSol_update_autofills__RAND__) == 'function') VcrIdSol_update_autofills__RAND__();
					}
				});
			}

		<?php } else { ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_VcrIdSol__RAND__.value, t: 'historico_vt', f: 'VcrIdSol' },
				success: function(resp) {
					$j('[id=VcrIdSol-container__RAND__], [id=VcrIdSol-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdSol-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=solicitudes_view_parent]').hide(); } else { $j('.btn[id=solicitudes_view_parent]').show(); }

					if(typeof(VcrIdSol_update_autofills__RAND__) == 'function') VcrIdSol_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function VcrIdRie_reload__RAND__() {
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint) { ?>

			$j("#VcrIdRie-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c) {
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { id: AppGini.current_VcrIdRie__RAND__.value, t: 'historico_vt', f: 'VcrIdRie' },
						success: function(resp) {
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="VcrIdRie"]').val(resp.results[0].id);
							$j('[id=VcrIdRie-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdRie-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=tipo_riesgo_view_parent]').hide(); } else { $j('.btn[id=tipo_riesgo_view_parent]').show(); }


							if(typeof(VcrIdRie_update_autofills__RAND__) == 'function') VcrIdRie_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term) { return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page) { return { s: term, p: page, t: 'historico_vt', f: 'VcrIdRie' }; },
					results: function(resp, page) { return resp; }
				},
				escapeMarkup: function(str) { return str; }
			}).on('change', function(e) {
				AppGini.current_VcrIdRie__RAND__.value = e.added.id;
				AppGini.current_VcrIdRie__RAND__.text = e.added.text;
				$j('[name="VcrIdRie"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=tipo_riesgo_view_parent]').hide(); } else { $j('.btn[id=tipo_riesgo_view_parent]').show(); }


				if(typeof(VcrIdRie_update_autofills__RAND__) == 'function') VcrIdRie_update_autofills__RAND__();
			});

			if(!$j("#VcrIdRie-container__RAND__").length) {
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_VcrIdRie__RAND__.value, t: 'historico_vt', f: 'VcrIdRie' },
					success: function(resp) {
						$j('[name="VcrIdRie"]').val(resp.results[0].id);
						$j('[id=VcrIdRie-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdRie-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=tipo_riesgo_view_parent]').hide(); } else { $j('.btn[id=tipo_riesgo_view_parent]').show(); }

						if(typeof(VcrIdRie_update_autofills__RAND__) == 'function') VcrIdRie_update_autofills__RAND__();
					}
				});
			}

		<?php } else { ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_VcrIdRie__RAND__.value, t: 'historico_vt', f: 'VcrIdRie' },
				success: function(resp) {
					$j('[id=VcrIdRie-container__RAND__], [id=VcrIdRie-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdRie-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=tipo_riesgo_view_parent]').hide(); } else { $j('.btn[id=tipo_riesgo_view_parent]').show(); }

					if(typeof(VcrIdRie_update_autofills__RAND__) == 'function') VcrIdRie_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function VcrIdBarVe_reload__RAND__() {
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint) { ?>

			$j("#VcrIdBarVe-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c) {
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { id: AppGini.current_VcrIdBarVe__RAND__.value, t: 'historico_vt', f: 'VcrIdBarVe' },
						success: function(resp) {
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="VcrIdBarVe"]').val(resp.results[0].id);
							$j('[id=VcrIdBarVe-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdBarVe-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=barrios_view_parent]').hide(); } else { $j('.btn[id=barrios_view_parent]').show(); }


							if(typeof(VcrIdBarVe_update_autofills__RAND__) == 'function') VcrIdBarVe_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term) { return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page) { return { s: term, p: page, t: 'historico_vt', f: 'VcrIdBarVe' }; },
					results: function(resp, page) { return resp; }
				},
				escapeMarkup: function(str) { return str; }
			}).on('change', function(e) {
				AppGini.current_VcrIdBarVe__RAND__.value = e.added.id;
				AppGini.current_VcrIdBarVe__RAND__.text = e.added.text;
				$j('[name="VcrIdBarVe"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=barrios_view_parent]').hide(); } else { $j('.btn[id=barrios_view_parent]').show(); }


				if(typeof(VcrIdBarVe_update_autofills__RAND__) == 'function') VcrIdBarVe_update_autofills__RAND__();
			});

			if(!$j("#VcrIdBarVe-container__RAND__").length) {
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_VcrIdBarVe__RAND__.value, t: 'historico_vt', f: 'VcrIdBarVe' },
					success: function(resp) {
						$j('[name="VcrIdBarVe"]').val(resp.results[0].id);
						$j('[id=VcrIdBarVe-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdBarVe-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=barrios_view_parent]').hide(); } else { $j('.btn[id=barrios_view_parent]').show(); }

						if(typeof(VcrIdBarVe_update_autofills__RAND__) == 'function') VcrIdBarVe_update_autofills__RAND__();
					}
				});
			}

		<?php } else { ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_VcrIdBarVe__RAND__.value, t: 'historico_vt', f: 'VcrIdBarVe' },
				success: function(resp) {
					$j('[id=VcrIdBarVe-container__RAND__], [id=VcrIdBarVe-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdBarVe-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=barrios_view_parent]').hide(); } else { $j('.btn[id=barrios_view_parent]').show(); }

					if(typeof(VcrIdBarVe_update_autofills__RAND__) == 'function') VcrIdBarVe_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function VcrIdCom_reload__RAND__() {
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint) { ?>

			$j("#VcrIdCom-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c) {
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { id: AppGini.current_VcrIdCom__RAND__.value, t: 'historico_vt', f: 'VcrIdCom' },
						success: function(resp) {
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="VcrIdCom"]').val(resp.results[0].id);
							$j('[id=VcrIdCom-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdCom-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=comunas_view_parent]').hide(); } else { $j('.btn[id=comunas_view_parent]').show(); }


							if(typeof(VcrIdCom_update_autofills__RAND__) == 'function') VcrIdCom_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term) { return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page) { return { s: term, p: page, t: 'historico_vt', f: 'VcrIdCom' }; },
					results: function(resp, page) { return resp; }
				},
				escapeMarkup: function(str) { return str; }
			}).on('change', function(e) {
				AppGini.current_VcrIdCom__RAND__.value = e.added.id;
				AppGini.current_VcrIdCom__RAND__.text = e.added.text;
				$j('[name="VcrIdCom"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=comunas_view_parent]').hide(); } else { $j('.btn[id=comunas_view_parent]').show(); }


				if(typeof(VcrIdCom_update_autofills__RAND__) == 'function') VcrIdCom_update_autofills__RAND__();
			});

			if(!$j("#VcrIdCom-container__RAND__").length) {
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_VcrIdCom__RAND__.value, t: 'historico_vt', f: 'VcrIdCom' },
					success: function(resp) {
						$j('[name="VcrIdCom"]').val(resp.results[0].id);
						$j('[id=VcrIdCom-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdCom-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=comunas_view_parent]').hide(); } else { $j('.btn[id=comunas_view_parent]').show(); }

						if(typeof(VcrIdCom_update_autofills__RAND__) == 'function') VcrIdCom_update_autofills__RAND__();
					}
				});
			}

		<?php } else { ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_VcrIdCom__RAND__.value, t: 'historico_vt', f: 'VcrIdCom' },
				success: function(resp) {
					$j('[id=VcrIdCom-container__RAND__], [id=VcrIdCom-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdCom-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=comunas_view_parent]').hide(); } else { $j('.btn[id=comunas_view_parent]').show(); }

					if(typeof(VcrIdCom_update_autofills__RAND__) == 'function') VcrIdCom_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function VcrIdCorr_reload__RAND__() {
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint) { ?>

			$j("#VcrIdCorr-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c) {
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { id: AppGini.current_VcrIdCorr__RAND__.value, t: 'historico_vt', f: 'VcrIdCorr' },
						success: function(resp) {
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="VcrIdCorr"]').val(resp.results[0].id);
							$j('[id=VcrIdCorr-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdCorr-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=corregimientos_view_parent]').hide(); } else { $j('.btn[id=corregimientos_view_parent]').show(); }


							if(typeof(VcrIdCorr_update_autofills__RAND__) == 'function') VcrIdCorr_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term) { return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page) { return { s: term, p: page, t: 'historico_vt', f: 'VcrIdCorr' }; },
					results: function(resp, page) { return resp; }
				},
				escapeMarkup: function(str) { return str; }
			}).on('change', function(e) {
				AppGini.current_VcrIdCorr__RAND__.value = e.added.id;
				AppGini.current_VcrIdCorr__RAND__.text = e.added.text;
				$j('[name="VcrIdCorr"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=corregimientos_view_parent]').hide(); } else { $j('.btn[id=corregimientos_view_parent]').show(); }


				if(typeof(VcrIdCorr_update_autofills__RAND__) == 'function') VcrIdCorr_update_autofills__RAND__();
			});

			if(!$j("#VcrIdCorr-container__RAND__").length) {
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_VcrIdCorr__RAND__.value, t: 'historico_vt', f: 'VcrIdCorr' },
					success: function(resp) {
						$j('[name="VcrIdCorr"]').val(resp.results[0].id);
						$j('[id=VcrIdCorr-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdCorr-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=corregimientos_view_parent]').hide(); } else { $j('.btn[id=corregimientos_view_parent]').show(); }

						if(typeof(VcrIdCorr_update_autofills__RAND__) == 'function') VcrIdCorr_update_autofills__RAND__();
					}
				});
			}

		<?php } else { ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_VcrIdCorr__RAND__.value, t: 'historico_vt', f: 'VcrIdCorr' },
				success: function(resp) {
					$j('[id=VcrIdCorr-container__RAND__], [id=VcrIdCorr-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdCorr-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=corregimientos_view_parent]').hide(); } else { $j('.btn[id=corregimientos_view_parent]').show(); }

					if(typeof(VcrIdCorr_update_autofills__RAND__) == 'function') VcrIdCorr_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function VcrIdMot_reload__RAND__() {
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint) { ?>

			$j("#VcrIdMot-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c) {
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { id: AppGini.current_VcrIdMot__RAND__.value, t: 'historico_vt', f: 'VcrIdMot' },
						success: function(resp) {
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="VcrIdMot"]').val(resp.results[0].id);
							$j('[id=VcrIdMot-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdMot-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=motivo_visita_view_parent]').hide(); } else { $j('.btn[id=motivo_visita_view_parent]').show(); }


							if(typeof(VcrIdMot_update_autofills__RAND__) == 'function') VcrIdMot_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term) { return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page) { return { s: term, p: page, t: 'historico_vt', f: 'VcrIdMot' }; },
					results: function(resp, page) { return resp; }
				},
				escapeMarkup: function(str) { return str; }
			}).on('change', function(e) {
				AppGini.current_VcrIdMot__RAND__.value = e.added.id;
				AppGini.current_VcrIdMot__RAND__.text = e.added.text;
				$j('[name="VcrIdMot"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=motivo_visita_view_parent]').hide(); } else { $j('.btn[id=motivo_visita_view_parent]').show(); }


				if(typeof(VcrIdMot_update_autofills__RAND__) == 'function') VcrIdMot_update_autofills__RAND__();
			});

			if(!$j("#VcrIdMot-container__RAND__").length) {
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_VcrIdMot__RAND__.value, t: 'historico_vt', f: 'VcrIdMot' },
					success: function(resp) {
						$j('[name="VcrIdMot"]').val(resp.results[0].id);
						$j('[id=VcrIdMot-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdMot-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=motivo_visita_view_parent]').hide(); } else { $j('.btn[id=motivo_visita_view_parent]').show(); }

						if(typeof(VcrIdMot_update_autofills__RAND__) == 'function') VcrIdMot_update_autofills__RAND__();
					}
				});
			}

		<?php } else { ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_VcrIdMot__RAND__.value, t: 'historico_vt', f: 'VcrIdMot' },
				success: function(resp) {
					$j('[id=VcrIdMot-container__RAND__], [id=VcrIdMot-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdMot-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=motivo_visita_view_parent]').hide(); } else { $j('.btn[id=motivo_visita_view_parent]').show(); }

					if(typeof(VcrIdMot_update_autofills__RAND__) == 'function') VcrIdMot_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function VcrIdFen_reload__RAND__() {
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint) { ?>

			$j("#VcrIdFen-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c) {
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { id: AppGini.current_VcrIdFen__RAND__.value, t: 'historico_vt', f: 'VcrIdFen' },
						success: function(resp) {
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="VcrIdFen"]').val(resp.results[0].id);
							$j('[id=VcrIdFen-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdFen-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=fenomenos_view_parent]').hide(); } else { $j('.btn[id=fenomenos_view_parent]').show(); }


							if(typeof(VcrIdFen_update_autofills__RAND__) == 'function') VcrIdFen_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term) { return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page) { return { s: term, p: page, t: 'historico_vt', f: 'VcrIdFen' }; },
					results: function(resp, page) { return resp; }
				},
				escapeMarkup: function(str) { return str; }
			}).on('change', function(e) {
				AppGini.current_VcrIdFen__RAND__.value = e.added.id;
				AppGini.current_VcrIdFen__RAND__.text = e.added.text;
				$j('[name="VcrIdFen"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=fenomenos_view_parent]').hide(); } else { $j('.btn[id=fenomenos_view_parent]').show(); }


				if(typeof(VcrIdFen_update_autofills__RAND__) == 'function') VcrIdFen_update_autofills__RAND__();
			});

			if(!$j("#VcrIdFen-container__RAND__").length) {
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_VcrIdFen__RAND__.value, t: 'historico_vt', f: 'VcrIdFen' },
					success: function(resp) {
						$j('[name="VcrIdFen"]').val(resp.results[0].id);
						$j('[id=VcrIdFen-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdFen-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=fenomenos_view_parent]').hide(); } else { $j('.btn[id=fenomenos_view_parent]').show(); }

						if(typeof(VcrIdFen_update_autofills__RAND__) == 'function') VcrIdFen_update_autofills__RAND__();
					}
				});
			}

		<?php } else { ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_VcrIdFen__RAND__.value, t: 'historico_vt', f: 'VcrIdFen' },
				success: function(resp) {
					$j('[id=VcrIdFen-container__RAND__], [id=VcrIdFen-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdFen-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=fenomenos_view_parent]').hide(); } else { $j('.btn[id=fenomenos_view_parent]').show(); }

					if(typeof(VcrIdFen_update_autofills__RAND__) == 'function') VcrIdFen_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function VcrIdCar_reload__RAND__() {
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint) { ?>

			$j("#VcrIdCar-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c) {
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { id: AppGini.current_VcrIdCar__RAND__.value, t: 'historico_vt', f: 'VcrIdCar' },
						success: function(resp) {
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="VcrIdCar"]').val(resp.results[0].id);
							$j('[id=VcrIdCar-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdCar-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=caracteristicas_evento_view_parent]').hide(); } else { $j('.btn[id=caracteristicas_evento_view_parent]').show(); }


							if(typeof(VcrIdCar_update_autofills__RAND__) == 'function') VcrIdCar_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term) { return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page) { return { s: term, p: page, t: 'historico_vt', f: 'VcrIdCar' }; },
					results: function(resp, page) { return resp; }
				},
				escapeMarkup: function(str) { return str; }
			}).on('change', function(e) {
				AppGini.current_VcrIdCar__RAND__.value = e.added.id;
				AppGini.current_VcrIdCar__RAND__.text = e.added.text;
				$j('[name="VcrIdCar"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=caracteristicas_evento_view_parent]').hide(); } else { $j('.btn[id=caracteristicas_evento_view_parent]').show(); }


				if(typeof(VcrIdCar_update_autofills__RAND__) == 'function') VcrIdCar_update_autofills__RAND__();
			});

			if(!$j("#VcrIdCar-container__RAND__").length) {
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_VcrIdCar__RAND__.value, t: 'historico_vt', f: 'VcrIdCar' },
					success: function(resp) {
						$j('[name="VcrIdCar"]').val(resp.results[0].id);
						$j('[id=VcrIdCar-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdCar-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=caracteristicas_evento_view_parent]').hide(); } else { $j('.btn[id=caracteristicas_evento_view_parent]').show(); }

						if(typeof(VcrIdCar_update_autofills__RAND__) == 'function') VcrIdCar_update_autofills__RAND__();
					}
				});
			}

		<?php } else { ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_VcrIdCar__RAND__.value, t: 'historico_vt', f: 'VcrIdCar' },
				success: function(resp) {
					$j('[id=VcrIdCar-container__RAND__], [id=VcrIdCar-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdCar-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=caracteristicas_evento_view_parent]').hide(); } else { $j('.btn[id=caracteristicas_evento_view_parent]').show(); }

					if(typeof(VcrIdCar_update_autofills__RAND__) == 'function') VcrIdCar_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function VcrIdTra1_reload__RAND__() {
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint) { ?>

			$j("#VcrIdTra1-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c) {
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { id: AppGini.current_VcrIdTra1__RAND__.value, t: 'historico_vt', f: 'VcrIdTra1' },
						success: function(resp) {
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="VcrIdTra1"]').val(resp.results[0].id);
							$j('[id=VcrIdTra1-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdTra1-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }


							if(typeof(VcrIdTra1_update_autofills__RAND__) == 'function') VcrIdTra1_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term) { return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page) { return { s: term, p: page, t: 'historico_vt', f: 'VcrIdTra1' }; },
					results: function(resp, page) { return resp; }
				},
				escapeMarkup: function(str) { return str; }
			}).on('change', function(e) {
				AppGini.current_VcrIdTra1__RAND__.value = e.added.id;
				AppGini.current_VcrIdTra1__RAND__.text = e.added.text;
				$j('[name="VcrIdTra1"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }


				if(typeof(VcrIdTra1_update_autofills__RAND__) == 'function') VcrIdTra1_update_autofills__RAND__();
			});

			if(!$j("#VcrIdTra1-container__RAND__").length) {
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_VcrIdTra1__RAND__.value, t: 'historico_vt', f: 'VcrIdTra1' },
					success: function(resp) {
						$j('[name="VcrIdTra1"]').val(resp.results[0].id);
						$j('[id=VcrIdTra1-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdTra1-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }

						if(typeof(VcrIdTra1_update_autofills__RAND__) == 'function') VcrIdTra1_update_autofills__RAND__();
					}
				});
			}

		<?php } else { ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_VcrIdTra1__RAND__.value, t: 'historico_vt', f: 'VcrIdTra1' },
				success: function(resp) {
					$j('[id=VcrIdTra1-container__RAND__], [id=VcrIdTra1-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdTra1-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }

					if(typeof(VcrIdTra1_update_autofills__RAND__) == 'function') VcrIdTra1_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function VcrIdTra2_reload__RAND__() {
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint) { ?>

			$j("#VcrIdTra2-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c) {
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { id: AppGini.current_VcrIdTra2__RAND__.value, t: 'historico_vt', f: 'VcrIdTra2' },
						success: function(resp) {
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="VcrIdTra2"]').val(resp.results[0].id);
							$j('[id=VcrIdTra2-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdTra2-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }


							if(typeof(VcrIdTra2_update_autofills__RAND__) == 'function') VcrIdTra2_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term) { return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page) { return { s: term, p: page, t: 'historico_vt', f: 'VcrIdTra2' }; },
					results: function(resp, page) { return resp; }
				},
				escapeMarkup: function(str) { return str; }
			}).on('change', function(e) {
				AppGini.current_VcrIdTra2__RAND__.value = e.added.id;
				AppGini.current_VcrIdTra2__RAND__.text = e.added.text;
				$j('[name="VcrIdTra2"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }


				if(typeof(VcrIdTra2_update_autofills__RAND__) == 'function') VcrIdTra2_update_autofills__RAND__();
			});

			if(!$j("#VcrIdTra2-container__RAND__").length) {
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_VcrIdTra2__RAND__.value, t: 'historico_vt', f: 'VcrIdTra2' },
					success: function(resp) {
						$j('[name="VcrIdTra2"]').val(resp.results[0].id);
						$j('[id=VcrIdTra2-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdTra2-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }

						if(typeof(VcrIdTra2_update_autofills__RAND__) == 'function') VcrIdTra2_update_autofills__RAND__();
					}
				});
			}

		<?php } else { ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_VcrIdTra2__RAND__.value, t: 'historico_vt', f: 'VcrIdTra2' },
				success: function(resp) {
					$j('[id=VcrIdTra2-container__RAND__], [id=VcrIdTra2-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdTra2-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }

					if(typeof(VcrIdTra2_update_autofills__RAND__) == 'function') VcrIdTra2_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function VcrIdTra3_reload__RAND__() {
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint) { ?>

			$j("#VcrIdTra3-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c) {
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { id: AppGini.current_VcrIdTra3__RAND__.value, t: 'historico_vt', f: 'VcrIdTra3' },
						success: function(resp) {
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="VcrIdTra3"]').val(resp.results[0].id);
							$j('[id=VcrIdTra3-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdTra3-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }


							if(typeof(VcrIdTra3_update_autofills__RAND__) == 'function') VcrIdTra3_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term) { return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page) { return { s: term, p: page, t: 'historico_vt', f: 'VcrIdTra3' }; },
					results: function(resp, page) { return resp; }
				},
				escapeMarkup: function(str) { return str; }
			}).on('change', function(e) {
				AppGini.current_VcrIdTra3__RAND__.value = e.added.id;
				AppGini.current_VcrIdTra3__RAND__.text = e.added.text;
				$j('[name="VcrIdTra3"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }


				if(typeof(VcrIdTra3_update_autofills__RAND__) == 'function') VcrIdTra3_update_autofills__RAND__();
			});

			if(!$j("#VcrIdTra3-container__RAND__").length) {
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_VcrIdTra3__RAND__.value, t: 'historico_vt', f: 'VcrIdTra3' },
					success: function(resp) {
						$j('[name="VcrIdTra3"]').val(resp.results[0].id);
						$j('[id=VcrIdTra3-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdTra3-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }

						if(typeof(VcrIdTra3_update_autofills__RAND__) == 'function') VcrIdTra3_update_autofills__RAND__();
					}
				});
			}

		<?php } else { ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_VcrIdTra3__RAND__.value, t: 'historico_vt', f: 'VcrIdTra3' },
				success: function(resp) {
					$j('[id=VcrIdTra3-container__RAND__], [id=VcrIdTra3-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdTra3-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }

					if(typeof(VcrIdTra3_update_autofills__RAND__) == 'function') VcrIdTra3_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function VcrIdTra4_reload__RAND__() {
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint) { ?>

			$j("#VcrIdTra4-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c) {
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { id: AppGini.current_VcrIdTra4__RAND__.value, t: 'historico_vt', f: 'VcrIdTra4' },
						success: function(resp) {
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="VcrIdTra4"]').val(resp.results[0].id);
							$j('[id=VcrIdTra4-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdTra4-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }


							if(typeof(VcrIdTra4_update_autofills__RAND__) == 'function') VcrIdTra4_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term) { return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page) { return { s: term, p: page, t: 'historico_vt', f: 'VcrIdTra4' }; },
					results: function(resp, page) { return resp; }
				},
				escapeMarkup: function(str) { return str; }
			}).on('change', function(e) {
				AppGini.current_VcrIdTra4__RAND__.value = e.added.id;
				AppGini.current_VcrIdTra4__RAND__.text = e.added.text;
				$j('[name="VcrIdTra4"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }


				if(typeof(VcrIdTra4_update_autofills__RAND__) == 'function') VcrIdTra4_update_autofills__RAND__();
			});

			if(!$j("#VcrIdTra4-container__RAND__").length) {
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_VcrIdTra4__RAND__.value, t: 'historico_vt', f: 'VcrIdTra4' },
					success: function(resp) {
						$j('[name="VcrIdTra4"]').val(resp.results[0].id);
						$j('[id=VcrIdTra4-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdTra4-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }

						if(typeof(VcrIdTra4_update_autofills__RAND__) == 'function') VcrIdTra4_update_autofills__RAND__();
					}
				});
			}

		<?php } else { ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_VcrIdTra4__RAND__.value, t: 'historico_vt', f: 'VcrIdTra4' },
				success: function(resp) {
					$j('[id=VcrIdTra4-container__RAND__], [id=VcrIdTra4-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdTra4-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }

					if(typeof(VcrIdTra4_update_autofills__RAND__) == 'function') VcrIdTra4_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function VcrIdTra5_reload__RAND__() {
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint) { ?>

			$j("#VcrIdTra5-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c) {
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { id: AppGini.current_VcrIdTra5__RAND__.value, t: 'historico_vt', f: 'VcrIdTra5' },
						success: function(resp) {
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="VcrIdTra5"]').val(resp.results[0].id);
							$j('[id=VcrIdTra5-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdTra5-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }


							if(typeof(VcrIdTra5_update_autofills__RAND__) == 'function') VcrIdTra5_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term) { return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page) { return { s: term, p: page, t: 'historico_vt', f: 'VcrIdTra5' }; },
					results: function(resp, page) { return resp; }
				},
				escapeMarkup: function(str) { return str; }
			}).on('change', function(e) {
				AppGini.current_VcrIdTra5__RAND__.value = e.added.id;
				AppGini.current_VcrIdTra5__RAND__.text = e.added.text;
				$j('[name="VcrIdTra5"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }


				if(typeof(VcrIdTra5_update_autofills__RAND__) == 'function') VcrIdTra5_update_autofills__RAND__();
			});

			if(!$j("#VcrIdTra5-container__RAND__").length) {
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_VcrIdTra5__RAND__.value, t: 'historico_vt', f: 'VcrIdTra5' },
					success: function(resp) {
						$j('[name="VcrIdTra5"]').val(resp.results[0].id);
						$j('[id=VcrIdTra5-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdTra5-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }

						if(typeof(VcrIdTra5_update_autofills__RAND__) == 'function') VcrIdTra5_update_autofills__RAND__();
					}
				});
			}

		<?php } else { ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_VcrIdTra5__RAND__.value, t: 'historico_vt', f: 'VcrIdTra5' },
				success: function(resp) {
					$j('[id=VcrIdTra5-container__RAND__], [id=VcrIdTra5-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdTra5-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }

					if(typeof(VcrIdTra5_update_autofills__RAND__) == 'function') VcrIdTra5_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function VcrIdTra6_reload__RAND__() {
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint) { ?>

			$j("#VcrIdTra6-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c) {
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { id: AppGini.current_VcrIdTra6__RAND__.value, t: 'historico_vt', f: 'VcrIdTra6' },
						success: function(resp) {
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="VcrIdTra6"]').val(resp.results[0].id);
							$j('[id=VcrIdTra6-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdTra6-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }


							if(typeof(VcrIdTra6_update_autofills__RAND__) == 'function') VcrIdTra6_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term) { return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page) { return { s: term, p: page, t: 'historico_vt', f: 'VcrIdTra6' }; },
					results: function(resp, page) { return resp; }
				},
				escapeMarkup: function(str) { return str; }
			}).on('change', function(e) {
				AppGini.current_VcrIdTra6__RAND__.value = e.added.id;
				AppGini.current_VcrIdTra6__RAND__.text = e.added.text;
				$j('[name="VcrIdTra6"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }


				if(typeof(VcrIdTra6_update_autofills__RAND__) == 'function') VcrIdTra6_update_autofills__RAND__();
			});

			if(!$j("#VcrIdTra6-container__RAND__").length) {
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_VcrIdTra6__RAND__.value, t: 'historico_vt', f: 'VcrIdTra6' },
					success: function(resp) {
						$j('[name="VcrIdTra6"]').val(resp.results[0].id);
						$j('[id=VcrIdTra6-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdTra6-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }

						if(typeof(VcrIdTra6_update_autofills__RAND__) == 'function') VcrIdTra6_update_autofills__RAND__();
					}
				});
			}

		<?php } else { ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_VcrIdTra6__RAND__.value, t: 'historico_vt', f: 'VcrIdTra6' },
				success: function(resp) {
					$j('[id=VcrIdTra6-container__RAND__], [id=VcrIdTra6-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdTra6-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }

					if(typeof(VcrIdTra6_update_autofills__RAND__) == 'function') VcrIdTra6_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function VcrIdTra7_reload__RAND__() {
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint) { ?>

			$j("#VcrIdTra7-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c) {
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { id: AppGini.current_VcrIdTra7__RAND__.value, t: 'historico_vt', f: 'VcrIdTra7' },
						success: function(resp) {
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="VcrIdTra7"]').val(resp.results[0].id);
							$j('[id=VcrIdTra7-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdTra7-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }


							if(typeof(VcrIdTra7_update_autofills__RAND__) == 'function') VcrIdTra7_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term) { return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page) { return { s: term, p: page, t: 'historico_vt', f: 'VcrIdTra7' }; },
					results: function(resp, page) { return resp; }
				},
				escapeMarkup: function(str) { return str; }
			}).on('change', function(e) {
				AppGini.current_VcrIdTra7__RAND__.value = e.added.id;
				AppGini.current_VcrIdTra7__RAND__.text = e.added.text;
				$j('[name="VcrIdTra7"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }


				if(typeof(VcrIdTra7_update_autofills__RAND__) == 'function') VcrIdTra7_update_autofills__RAND__();
			});

			if(!$j("#VcrIdTra7-container__RAND__").length) {
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_VcrIdTra7__RAND__.value, t: 'historico_vt', f: 'VcrIdTra7' },
					success: function(resp) {
						$j('[name="VcrIdTra7"]').val(resp.results[0].id);
						$j('[id=VcrIdTra7-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdTra7-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }

						if(typeof(VcrIdTra7_update_autofills__RAND__) == 'function') VcrIdTra7_update_autofills__RAND__();
					}
				});
			}

		<?php } else { ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_VcrIdTra7__RAND__.value, t: 'historico_vt', f: 'VcrIdTra7' },
				success: function(resp) {
					$j('[id=VcrIdTra7-container__RAND__], [id=VcrIdTra7-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdTra7-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }

					if(typeof(VcrIdTra7_update_autofills__RAND__) == 'function') VcrIdTra7_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function VcrIdTra8_reload__RAND__() {
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint) { ?>

			$j("#VcrIdTra8-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c) {
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { id: AppGini.current_VcrIdTra8__RAND__.value, t: 'historico_vt', f: 'VcrIdTra8' },
						success: function(resp) {
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="VcrIdTra8"]').val(resp.results[0].id);
							$j('[id=VcrIdTra8-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdTra8-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }


							if(typeof(VcrIdTra8_update_autofills__RAND__) == 'function') VcrIdTra8_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term) { return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page) { return { s: term, p: page, t: 'historico_vt', f: 'VcrIdTra8' }; },
					results: function(resp, page) { return resp; }
				},
				escapeMarkup: function(str) { return str; }
			}).on('change', function(e) {
				AppGini.current_VcrIdTra8__RAND__.value = e.added.id;
				AppGini.current_VcrIdTra8__RAND__.text = e.added.text;
				$j('[name="VcrIdTra8"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }


				if(typeof(VcrIdTra8_update_autofills__RAND__) == 'function') VcrIdTra8_update_autofills__RAND__();
			});

			if(!$j("#VcrIdTra8-container__RAND__").length) {
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_VcrIdTra8__RAND__.value, t: 'historico_vt', f: 'VcrIdTra8' },
					success: function(resp) {
						$j('[name="VcrIdTra8"]').val(resp.results[0].id);
						$j('[id=VcrIdTra8-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdTra8-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }

						if(typeof(VcrIdTra8_update_autofills__RAND__) == 'function') VcrIdTra8_update_autofills__RAND__();
					}
				});
			}

		<?php } else { ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_VcrIdTra8__RAND__.value, t: 'historico_vt', f: 'VcrIdTra8' },
				success: function(resp) {
					$j('[id=VcrIdTra8-container__RAND__], [id=VcrIdTra8-container-readonly__RAND__]').html('<span class="match-text" id="VcrIdTra8-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>') { $j('.btn[id=dependencias_view_parent]').hide(); } else { $j('.btn[id=dependencias_view_parent]').show(); }

					if(typeof(VcrIdTra8_update_autofills__RAND__) == 'function') VcrIdTra8_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
	</script>
	<?php

	$lookups = str_replace('__RAND__', $rnd1, ob_get_clean());


	// code for template based detail view forms

	// open the detail view template
	$template_file = is_file("./{$TemplateDV}") ? "./{$TemplateDV}" : './templates/historico_vt_templateDV.html';
	$templateCode = @file_get_contents($template_file);

	// process form title
	$templateCode = str_replace('<%%DETAIL_VIEW_TITLE%%>', 'FORMATO VISITA DE VERIFICACI&#211;N DE CONDICIONES DE RIESGO NATURAL, SOCIO NATURAL Y TECNOL&#211;GICO', $templateCode);
	$templateCode = str_replace('<%%RND1%%>', $rnd1, $templateCode);
	$templateCode = str_replace('<%%EMBEDDED%%>', (Request::val('Embedded') ? 'Embedded=1' : ''), $templateCode);
	// process buttons
	if($AllowInsert) {
		if(!$selected_id) $templateCode = str_replace('<%%INSERT_BUTTON%%>', '<button type="submit" class="btn btn-success" id="insert" name="insert_x" value="1" onclick="return historico_vt_validateData();"><i class="glyphicon glyphicon-plus-sign"></i> ' . $Translation['Save New'] . '</button>', $templateCode);
		$templateCode = str_replace('<%%INSERT_BUTTON%%>', '<button type="submit" class="btn btn-default" id="insert" name="insert_x" value="1" onclick="return historico_vt_validateData();"><i class="glyphicon glyphicon-plus-sign"></i> ' . $Translation['Save As Copy'] . '</button>', $templateCode);
	} else {
		$templateCode = str_replace('<%%INSERT_BUTTON%%>', '', $templateCode);
	}

	// 'Back' button action
	if(Request::val('Embedded')) {
		$backAction = 'AppGini.closeParentModal(); return false;';
	} else {
		$backAction = '$j(\'form\').eq(0).attr(\'novalidate\', \'novalidate\'); document.myform.reset(); return true;';
	}

	if($selected_id) {
		if($AllowUpdate) {
			$templateCode = str_replace('<%%UPDATE_BUTTON%%>', '<button type="submit" class="btn btn-success btn-lg" id="update" name="update_x" value="1" onclick="return historico_vt_validateData();" title="' . html_attr($Translation['Save Changes']) . '"><i class="glyphicon glyphicon-ok"></i> ' . $Translation['Save Changes'] . '</button>', $templateCode);
		} else {
			$templateCode = str_replace('<%%UPDATE_BUTTON%%>', '', $templateCode);
		}
		if(($arrPerm['delete'] == 1 && $ownerMemberID == getLoggedMemberID()) || ($arrPerm['delete'] == 2 && $ownerGroupID == getLoggedGroupID()) || $arrPerm['delete'] == 3) { // allow delete?
			$templateCode = str_replace('<%%DELETE_BUTTON%%>', '<button type="submit" class="btn btn-danger" id="delete" name="delete_x" value="1" onclick="return confirm(\'' . $Translation['are you sure?'] . '\');" title="' . html_attr($Translation['Delete']) . '"><i class="glyphicon glyphicon-trash"></i> ' . $Translation['Delete'] . '</button>', $templateCode);
		} else {
			$templateCode = str_replace('<%%DELETE_BUTTON%%>', '', $templateCode);
		}
		$templateCode = str_replace('<%%DESELECT_BUTTON%%>', '<button type="submit" class="btn btn-default" id="deselect" name="deselect_x" value="1" onclick="' . $backAction . '" title="' . html_attr($Translation['Back']) . '"><i class="glyphicon glyphicon-chevron-left"></i> ' . $Translation['Back'] . '</button>', $templateCode);
	} else {
		$templateCode = str_replace('<%%UPDATE_BUTTON%%>', '', $templateCode);
		$templateCode = str_replace('<%%DELETE_BUTTON%%>', '', $templateCode);

		// if not in embedded mode and user has insert only but no view/update/delete,
		// remove 'back' button
		if(
			$arrPerm['insert']
			&& !$arrPerm['update'] && !$arrPerm['delete'] && !$arrPerm['view']
			&& !Request::val('Embedded')
		)
			$templateCode = str_replace('<%%DESELECT_BUTTON%%>', '', $templateCode);
		elseif($separateDV)
			$templateCode = str_replace(
				'<%%DESELECT_BUTTON%%>', 
				'<button
					type="submit" 
					class="btn btn-default" 
					id="deselect" 
					name="deselect_x" 
					value="1" 
					onclick="' . $backAction . '" 
					title="' . html_attr($Translation['Back']) . '">
						<i class="glyphicon glyphicon-chevron-left"></i> ' .
						$Translation['Back'] .
				'</button>',
				$templateCode
			);
		else
			$templateCode = str_replace('<%%DESELECT_BUTTON%%>', '', $templateCode);
	}

	// set records to read only if user can't insert new records and can't edit current record
	if(($selected_id && !$AllowUpdate && !$AllowInsert) || (!$selected_id && !$AllowInsert)) {
		$jsReadOnly = '';
		$jsReadOnly .= "\tjQuery('#VcrCodHis').replaceWith('<div class=\"form-control-static\" id=\"VcrCodHis\">' + (jQuery('#VcrCodHis').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#Vcrano').replaceWith('<div class=\"form-control-static\" id=\"Vcrano\">' + (jQuery('#Vcrano').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#VcrIdSerP').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#VcrIdSerP_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#VcrIdSol').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#VcrIdSol_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#VcrRadSol').replaceWith('<div class=\"form-control-static\" id=\"VcrRadSol\">' + (jQuery('#VcrRadSol').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#VcrFecSol').prop('readonly', true);\n";
		$jsReadOnly .= "\tjQuery('#VcrFecSolDay, #VcrFecSolMonth, #VcrFecSolYear').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#VcrRadRes').replaceWith('<div class=\"form-control-static\" id=\"VcrRadRes\">' + (jQuery('#VcrRadRes').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#VcrFecRad').prop('readonly', true);\n";
		$jsReadOnly .= "\tjQuery('#VcrFecRadDay, #VcrFecRadMonth, #VcrFecRadYear').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#VcrDiaResp').replaceWith('<div class=\"form-control-static\" id=\"VcrDiaResp\">' + (jQuery('#VcrDiaResp').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#VcrIdRie').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#VcrIdRie_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#VcrEntSol').replaceWith('<div class=\"form-control-static\" id=\"VcrEntSol\">' + (jQuery('#VcrEntSol').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#VcrNomAti').replaceWith('<div class=\"form-control-static\" id=\"VcrNomAti\">' + (jQuery('#VcrNomAti').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#VcrNoIde').replaceWith('<div class=\"form-control-static\" id=\"VcrNoIde\">' + (jQuery('#VcrNoIde').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#VcrCel').replaceWith('<div class=\"form-control-static\" id=\"VcrCel\">' + (jQuery('#VcrCel').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#VcrCodForm').replaceWith('<div class=\"form-control-static\" id=\"VcrCodForm\">' + (jQuery('#VcrCodForm').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#VcrFecVis').prop('readonly', true);\n";
		$jsReadOnly .= "\tjQuery('#VcrFecVisDay, #VcrFecVisMonth, #VcrFecVisYear').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#VcrDir').replaceWith('<div class=\"form-control-static\" id=\"VcrDir\">' + (jQuery('#VcrDir').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#VcrIdBarVe').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#VcrIdBarVe_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#VcrIdCom').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#VcrIdCom_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#VcrIdCorr').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#VcrIdCorr_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#VcrLon').replaceWith('<div class=\"form-control-static\" id=\"VcrLon\">' + (jQuery('#VcrLon').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#VcrLat').replaceWith('<div class=\"form-control-static\" id=\"VcrLat\">' + (jQuery('#VcrLat').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#VcrIdMot').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#VcrIdMot_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#VcrIdFen').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#VcrIdFen_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#VcrIdCar').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#VcrIdCar_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#VcrAyuHum').replaceWith('<div class=\"form-control-static\" id=\"VcrAyuHum\">' + (jQuery('#VcrAyuHum').val() || '') + '</div>'); jQuery('#VcrAyuHum-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#VcrPerHer').replaceWith('<div class=\"form-control-static\" id=\"VcrPerHer\">' + (jQuery('#VcrPerHer').val() || '') + '</div>'); jQuery('#VcrPerHer-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#VcrPerFall').replaceWith('<div class=\"form-control-static\" id=\"VcrPerFall\">' + (jQuery('#VcrPerFall').val() || '') + '</div>'); jQuery('#VcrPerFall-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#VcrTraCas').replaceWith('<div class=\"form-control-static\" id=\"VcrTraCas\">' + (jQuery('#VcrTraCas').val() || '') + '</div>'); jQuery('#VcrTraCas-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#VcrCop').replaceWith('<div class=\"form-control-static\" id=\"VcrCop\">' + (jQuery('#VcrCop').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#VcrEstTra').replaceWith('<div class=\"form-control-static\" id=\"VcrEstTra\">' + (jQuery('#VcrEstTra').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#VcrObsHis').replaceWith('<div class=\"form-control-static\" id=\"VcrObsHis\">' + (jQuery('#VcrObsHis').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#VcrUbiInf').replaceWith('<div class=\"form-control-static\" id=\"VcrUbiInf\">' + (jQuery('#VcrUbiInf').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#VcrResInf').replaceWith('<div class=\"form-control-static\" id=\"VcrResInf\">' + (jQuery('#VcrResInf').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#VcrIdTra1').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#VcrIdTra1_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#VcrRadTra1').replaceWith('<div class=\"form-control-static\" id=\"VcrRadTra1\">' + (jQuery('#VcrRadTra1').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#VcrFecTra1').prop('readonly', true);\n";
		$jsReadOnly .= "\tjQuery('#VcrFecTra1Day, #VcrFecTra1Month, #VcrFecTra1Year').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#VcrResTra1').replaceWith('<div class=\"form-control-static\" id=\"VcrResTra1\">' + (jQuery('#VcrResTra1').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#VcrIdTra2').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#VcrIdTra2_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#VcrRadTra2').replaceWith('<div class=\"form-control-static\" id=\"VcrRadTra2\">' + (jQuery('#VcrRadTra2').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#VcrFecTra2').prop('readonly', true);\n";
		$jsReadOnly .= "\tjQuery('#VcrFecTra2Day, #VcrFecTra2Month, #VcrFecTra2Year').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#VcrResTra2').replaceWith('<div class=\"form-control-static\" id=\"VcrResTra2\">' + (jQuery('#VcrResTra2').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#VcrIdTra3').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#VcrIdTra3_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#VcrRadTra3').replaceWith('<div class=\"form-control-static\" id=\"VcrRadTra3\">' + (jQuery('#VcrRadTra3').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#VcrFecTra3').prop('readonly', true);\n";
		$jsReadOnly .= "\tjQuery('#VcrFecTra3Day, #VcrFecTra3Month, #VcrFecTra3Year').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#VcrResTra3').replaceWith('<div class=\"form-control-static\" id=\"VcrResTra3\">' + (jQuery('#VcrResTra3').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#VcrIdTra4').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#VcrIdTra4_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#VcrRadTra4').replaceWith('<div class=\"form-control-static\" id=\"VcrRadTra4\">' + (jQuery('#VcrRadTra4').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#VcrFecTra4').prop('readonly', true);\n";
		$jsReadOnly .= "\tjQuery('#VcrFecTra4Day, #VcrFecTra4Month, #VcrFecTra4Year').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#VcrResTra4').replaceWith('<div class=\"form-control-static\" id=\"VcrResTra4\">' + (jQuery('#VcrResTra4').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#VcrIdTra5').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#VcrIdTra5_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#VcrRadTra5').replaceWith('<div class=\"form-control-static\" id=\"VcrRadTra5\">' + (jQuery('#VcrRadTra5').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#VcrFecTra5').prop('readonly', true);\n";
		$jsReadOnly .= "\tjQuery('#VcrFecTra5Day, #VcrFecTra5Month, #VcrFecTra5Year').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#VcrResTra5').replaceWith('<div class=\"form-control-static\" id=\"VcrResTra5\">' + (jQuery('#VcrResTra5').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#VcrIdTra6').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#VcrIdTra6_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#VcrRadTra6').replaceWith('<div class=\"form-control-static\" id=\"VcrRadTra6\">' + (jQuery('#VcrRadTra6').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#VcrIdTra7').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#VcrIdTra7_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#VcrRadTra7').replaceWith('<div class=\"form-control-static\" id=\"VcrRadTra7\">' + (jQuery('#VcrRadTra7').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#VcrIdTra8').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#VcrIdTra8_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#VcrRadTra8').replaceWith('<div class=\"form-control-static\" id=\"VcrRadTra8\">' + (jQuery('#VcrRadTra8').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('.select2-container').hide();\n";

		$noUploads = true;
	} elseif($AllowInsert) {
		$jsEditable = "\tjQuery('form').eq(0).data('already_changed', true);"; // temporarily disable form change handler
		$jsEditable .= "\tjQuery('form').eq(0).data('already_changed', false);"; // re-enable form change handler
	}

	// process combos
	$templateCode = str_replace('<%%COMBO(VcrIdSerP)%%>', $combo_VcrIdSerP->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(VcrIdSerP)%%>', $combo_VcrIdSerP->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(VcrIdSerP)%%>', urlencode($combo_VcrIdSerP->MatchText), $templateCode);
	$templateCode = str_replace('<%%COMBO(VcrIdSol)%%>', $combo_VcrIdSol->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(VcrIdSol)%%>', $combo_VcrIdSol->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(VcrIdSol)%%>', urlencode($combo_VcrIdSol->MatchText), $templateCode);
	$templateCode = str_replace(
		'<%%COMBO(VcrFecSol)%%>', 
		($selected_id && !$arrPerm['edit'] && ($noSaveAsCopy || !$arrPerm['insert']) ? 
			'<div class="form-control-static">' . $combo_VcrFecSol->GetHTML(true) . '</div>' : 
			$combo_VcrFecSol->GetHTML()
		), $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(VcrFecSol)%%>', $combo_VcrFecSol->GetHTML(true), $templateCode);
	$templateCode = str_replace(
		'<%%COMBO(VcrFecRad)%%>', 
		($selected_id && !$arrPerm['edit'] && ($noSaveAsCopy || !$arrPerm['insert']) ? 
			'<div class="form-control-static">' . $combo_VcrFecRad->GetHTML(true) . '</div>' : 
			$combo_VcrFecRad->GetHTML()
		), $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(VcrFecRad)%%>', $combo_VcrFecRad->GetHTML(true), $templateCode);
	$templateCode = str_replace('<%%COMBO(VcrIdRie)%%>', $combo_VcrIdRie->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(VcrIdRie)%%>', $combo_VcrIdRie->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(VcrIdRie)%%>', urlencode($combo_VcrIdRie->MatchText), $templateCode);
	$templateCode = str_replace(
		'<%%COMBO(VcrFecVis)%%>', 
		($selected_id && !$arrPerm['edit'] && ($noSaveAsCopy || !$arrPerm['insert']) ? 
			'<div class="form-control-static">' . $combo_VcrFecVis->GetHTML(true) . '</div>' : 
			$combo_VcrFecVis->GetHTML()
		), $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(VcrFecVis)%%>', $combo_VcrFecVis->GetHTML(true), $templateCode);
	$templateCode = str_replace('<%%COMBO(VcrIdBarVe)%%>', $combo_VcrIdBarVe->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(VcrIdBarVe)%%>', $combo_VcrIdBarVe->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(VcrIdBarVe)%%>', urlencode($combo_VcrIdBarVe->MatchText), $templateCode);
	$templateCode = str_replace('<%%COMBO(VcrIdCom)%%>', $combo_VcrIdCom->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(VcrIdCom)%%>', $combo_VcrIdCom->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(VcrIdCom)%%>', urlencode($combo_VcrIdCom->MatchText), $templateCode);
	$templateCode = str_replace('<%%COMBO(VcrIdCorr)%%>', $combo_VcrIdCorr->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(VcrIdCorr)%%>', $combo_VcrIdCorr->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(VcrIdCorr)%%>', urlencode($combo_VcrIdCorr->MatchText), $templateCode);
	$templateCode = str_replace('<%%COMBO(VcrIdMot)%%>', $combo_VcrIdMot->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(VcrIdMot)%%>', $combo_VcrIdMot->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(VcrIdMot)%%>', urlencode($combo_VcrIdMot->MatchText), $templateCode);
	$templateCode = str_replace('<%%COMBO(VcrIdFen)%%>', $combo_VcrIdFen->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(VcrIdFen)%%>', $combo_VcrIdFen->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(VcrIdFen)%%>', urlencode($combo_VcrIdFen->MatchText), $templateCode);
	$templateCode = str_replace('<%%COMBO(VcrIdCar)%%>', $combo_VcrIdCar->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(VcrIdCar)%%>', $combo_VcrIdCar->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(VcrIdCar)%%>', urlencode($combo_VcrIdCar->MatchText), $templateCode);
	$templateCode = str_replace('<%%COMBO(VcrAyuHum)%%>', $combo_VcrAyuHum->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(VcrAyuHum)%%>', $combo_VcrAyuHum->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(VcrPerHer)%%>', $combo_VcrPerHer->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(VcrPerHer)%%>', $combo_VcrPerHer->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(VcrPerFall)%%>', $combo_VcrPerFall->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(VcrPerFall)%%>', $combo_VcrPerFall->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(VcrTraCas)%%>', $combo_VcrTraCas->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(VcrTraCas)%%>', $combo_VcrTraCas->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(VcrIdTra1)%%>', $combo_VcrIdTra1->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(VcrIdTra1)%%>', $combo_VcrIdTra1->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(VcrIdTra1)%%>', urlencode($combo_VcrIdTra1->MatchText), $templateCode);
	$templateCode = str_replace(
		'<%%COMBO(VcrFecTra1)%%>', 
		($selected_id && !$arrPerm['edit'] && ($noSaveAsCopy || !$arrPerm['insert']) ? 
			'<div class="form-control-static">' . $combo_VcrFecTra1->GetHTML(true) . '</div>' : 
			$combo_VcrFecTra1->GetHTML()
		), $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(VcrFecTra1)%%>', $combo_VcrFecTra1->GetHTML(true), $templateCode);
	$templateCode = str_replace('<%%COMBO(VcrIdTra2)%%>', $combo_VcrIdTra2->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(VcrIdTra2)%%>', $combo_VcrIdTra2->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(VcrIdTra2)%%>', urlencode($combo_VcrIdTra2->MatchText), $templateCode);
	$templateCode = str_replace(
		'<%%COMBO(VcrFecTra2)%%>', 
		($selected_id && !$arrPerm['edit'] && ($noSaveAsCopy || !$arrPerm['insert']) ? 
			'<div class="form-control-static">' . $combo_VcrFecTra2->GetHTML(true) . '</div>' : 
			$combo_VcrFecTra2->GetHTML()
		), $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(VcrFecTra2)%%>', $combo_VcrFecTra2->GetHTML(true), $templateCode);
	$templateCode = str_replace('<%%COMBO(VcrIdTra3)%%>', $combo_VcrIdTra3->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(VcrIdTra3)%%>', $combo_VcrIdTra3->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(VcrIdTra3)%%>', urlencode($combo_VcrIdTra3->MatchText), $templateCode);
	$templateCode = str_replace(
		'<%%COMBO(VcrFecTra3)%%>', 
		($selected_id && !$arrPerm['edit'] && ($noSaveAsCopy || !$arrPerm['insert']) ? 
			'<div class="form-control-static">' . $combo_VcrFecTra3->GetHTML(true) . '</div>' : 
			$combo_VcrFecTra3->GetHTML()
		), $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(VcrFecTra3)%%>', $combo_VcrFecTra3->GetHTML(true), $templateCode);
	$templateCode = str_replace('<%%COMBO(VcrIdTra4)%%>', $combo_VcrIdTra4->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(VcrIdTra4)%%>', $combo_VcrIdTra4->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(VcrIdTra4)%%>', urlencode($combo_VcrIdTra4->MatchText), $templateCode);
	$templateCode = str_replace(
		'<%%COMBO(VcrFecTra4)%%>', 
		($selected_id && !$arrPerm['edit'] && ($noSaveAsCopy || !$arrPerm['insert']) ? 
			'<div class="form-control-static">' . $combo_VcrFecTra4->GetHTML(true) . '</div>' : 
			$combo_VcrFecTra4->GetHTML()
		), $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(VcrFecTra4)%%>', $combo_VcrFecTra4->GetHTML(true), $templateCode);
	$templateCode = str_replace('<%%COMBO(VcrIdTra5)%%>', $combo_VcrIdTra5->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(VcrIdTra5)%%>', $combo_VcrIdTra5->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(VcrIdTra5)%%>', urlencode($combo_VcrIdTra5->MatchText), $templateCode);
	$templateCode = str_replace(
		'<%%COMBO(VcrFecTra5)%%>', 
		($selected_id && !$arrPerm['edit'] && ($noSaveAsCopy || !$arrPerm['insert']) ? 
			'<div class="form-control-static">' . $combo_VcrFecTra5->GetHTML(true) . '</div>' : 
			$combo_VcrFecTra5->GetHTML()
		), $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(VcrFecTra5)%%>', $combo_VcrFecTra5->GetHTML(true), $templateCode);
	$templateCode = str_replace('<%%COMBO(VcrIdTra6)%%>', $combo_VcrIdTra6->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(VcrIdTra6)%%>', $combo_VcrIdTra6->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(VcrIdTra6)%%>', urlencode($combo_VcrIdTra6->MatchText), $templateCode);
	$templateCode = str_replace('<%%COMBO(VcrIdTra7)%%>', $combo_VcrIdTra7->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(VcrIdTra7)%%>', $combo_VcrIdTra7->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(VcrIdTra7)%%>', urlencode($combo_VcrIdTra7->MatchText), $templateCode);
	$templateCode = str_replace('<%%COMBO(VcrIdTra8)%%>', $combo_VcrIdTra8->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(VcrIdTra8)%%>', $combo_VcrIdTra8->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(VcrIdTra8)%%>', urlencode($combo_VcrIdTra8->MatchText), $templateCode);

	/* lookup fields array: 'lookup field name' => ['parent table name', 'lookup field caption'] */
	$lookup_fields = ['VcrIdSerP' => ['servidor_publico', 'FUNCIONARIO / CONTRATISTA:'], 'VcrIdSol' => ['solicitudes', 'TIPO SOLICITUD:'], 'VcrIdRie' => ['tipo_riesgo', 'NIVEL DE RIESGO'], 'VcrIdBarVe' => ['barrios', 'BARRIO:'], 'VcrIdCom' => ['comunas', 'COMUNA/LOCALIDAD:'], 'VcrIdCorr' => ['corregimientos', 'VEREDA/CORREGIMIENTO:'], 'VcrIdMot' => ['motivo_visita', 'MOTIVO VISITA:'], 'VcrIdFen' => ['fenomenos', 'TIPO DE FEN&#211;MENO:'], 'VcrIdCar' => ['caracteristicas_evento', 'CARACTER&#205;STICAS DEL EVENTO:'], 'VcrIdTra1' => ['dependencias', 'TRASLADO A ORGANISMO O ENTIDAD No.1:'], 'VcrIdTra2' => ['dependencias', 'TRASLADO A ORGANISMO O ENTIDAD No.2:'], 'VcrIdTra3' => ['dependencias', 'TRASLADO A ORGANISMO O ENTIDAD No.3:'], 'VcrIdTra4' => ['dependencias', 'TRASLADO A ORGANISMO O ENTIDAD No.4:'], 'VcrIdTra5' => ['dependencias', 'TRASLADO A ORGANISMO O ENTIDAD No.5:'], 'VcrIdTra6' => ['dependencias', 'TRASLADO A ORGANISMO O ENTIDAD No.6:'], 'VcrIdTra7' => ['dependencias', 'TRASLADO A ORGANISMO O ENTIDAD No.7:'], 'VcrIdTra8' => ['dependencias', 'TRASLADO A ORGANISMO O ENTIDAD No.8:'], ];
	foreach($lookup_fields as $luf => $ptfc) {
		$pt_perm = getTablePermissions($ptfc[0]);

		// process foreign key links
		if($pt_perm['view'] || $pt_perm['edit']) {
			$templateCode = str_replace("<%%PLINK({$luf})%%>", '<button type="button" class="btn btn-default view_parent" id="' . $ptfc[0] . '_view_parent" title="' . html_attr($Translation['View'] . ' ' . $ptfc[1]) . '"><i class="glyphicon glyphicon-eye-open"></i></button>', $templateCode);
		}

		// if user has insert permission to parent table of a lookup field, put an add new button
		if($pt_perm['insert'] /* && !Request::val('Embedded')*/) {
			$templateCode = str_replace("<%%ADDNEW({$ptfc[0]})%%>", '<button type="button" class="btn btn-default add_new_parent" id="' . $ptfc[0] . '_add_new" title="' . html_attr($Translation['Add New'] . ' ' . $ptfc[1]) . '"><i class="glyphicon glyphicon-plus text-success"></i></button>', $templateCode);
		}
	}

	// process images
	$templateCode = str_replace('<%%UPLOADFILE(VcrId)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrCodHis)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(Vcrano)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrIdSerP)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrIdSol)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrRadSol)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrFecSol)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrRadRes)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrFecRad)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrDiaResp)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrIdRie)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrEntSol)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrNomAti)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrNoIde)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrCel)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrCodForm)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrFecVis)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrDir)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrIdBarVe)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrIdCom)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrIdCorr)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrLon)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrLat)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrIdMot)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrIdFen)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrIdCar)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrAyuHum)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrPerHer)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrPerFall)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrTraCas)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrCop)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrEstTra)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrObsHis)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrUbiInf)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrResInf)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrIdTra1)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrRadTra1)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrFecTra1)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrResTra1)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrIdTra2)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrRadTra2)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrFecTra2)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrResTra2)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrIdTra3)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrRadTra3)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrFecTra3)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrResTra3)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrIdTra4)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrRadTra4)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrFecTra4)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrResTra4)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrIdTra5)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrRadTra5)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrFecTra5)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrResTra5)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrIdTra6)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrRadTra6)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrIdTra7)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrRadTra7)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrIdTra8)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(VcrRadTra8)%%>', '', $templateCode);

	// process values
	if($selected_id) {
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrId)%%>', safe_html($urow['VcrId']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrId)%%>', html_attr($row['VcrId']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrId)%%>', urlencode($urow['VcrId']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrCodHis)%%>', safe_html($urow['VcrCodHis']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrCodHis)%%>', html_attr($row['VcrCodHis']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrCodHis)%%>', urlencode($urow['VcrCodHis']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(Vcrano)%%>', safe_html($urow['Vcrano']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(Vcrano)%%>', html_attr($row['Vcrano']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Vcrano)%%>', urlencode($urow['Vcrano']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrIdSerP)%%>', safe_html($urow['VcrIdSerP']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrIdSerP)%%>', html_attr($row['VcrIdSerP']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdSerP)%%>', urlencode($urow['VcrIdSerP']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrIdSol)%%>', safe_html($urow['VcrIdSol']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrIdSol)%%>', html_attr($row['VcrIdSol']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdSol)%%>', urlencode($urow['VcrIdSol']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrRadSol)%%>', safe_html($urow['VcrRadSol']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrRadSol)%%>', html_attr($row['VcrRadSol']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrRadSol)%%>', urlencode($urow['VcrRadSol']), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrFecSol)%%>', app_datetime($row['VcrFecSol']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrFecSol)%%>', urlencode(app_datetime($urow['VcrFecSol'])), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrRadRes)%%>', safe_html($urow['VcrRadRes']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrRadRes)%%>', html_attr($row['VcrRadRes']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrRadRes)%%>', urlencode($urow['VcrRadRes']), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrFecRad)%%>', app_datetime($row['VcrFecRad']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrFecRad)%%>', urlencode(app_datetime($urow['VcrFecRad'])), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrDiaResp)%%>', safe_html($urow['VcrDiaResp']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrDiaResp)%%>', html_attr($row['VcrDiaResp']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrDiaResp)%%>', urlencode($urow['VcrDiaResp']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrIdRie)%%>', safe_html($urow['VcrIdRie']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrIdRie)%%>', html_attr($row['VcrIdRie']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdRie)%%>', urlencode($urow['VcrIdRie']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrEntSol)%%>', safe_html($urow['VcrEntSol']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrEntSol)%%>', html_attr($row['VcrEntSol']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrEntSol)%%>', urlencode($urow['VcrEntSol']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrNomAti)%%>', safe_html($urow['VcrNomAti']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrNomAti)%%>', html_attr($row['VcrNomAti']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrNomAti)%%>', urlencode($urow['VcrNomAti']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrNoIde)%%>', safe_html($urow['VcrNoIde']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrNoIde)%%>', html_attr($row['VcrNoIde']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrNoIde)%%>', urlencode($urow['VcrNoIde']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrCel)%%>', safe_html($urow['VcrCel']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrCel)%%>', html_attr($row['VcrCel']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrCel)%%>', urlencode($urow['VcrCel']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrCodForm)%%>', safe_html($urow['VcrCodForm']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrCodForm)%%>', html_attr($row['VcrCodForm']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrCodForm)%%>', urlencode($urow['VcrCodForm']), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrFecVis)%%>', app_datetime($row['VcrFecVis']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrFecVis)%%>', urlencode(app_datetime($urow['VcrFecVis'])), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrDir)%%>', safe_html($urow['VcrDir']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrDir)%%>', html_attr($row['VcrDir']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrDir)%%>', urlencode($urow['VcrDir']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrIdBarVe)%%>', safe_html($urow['VcrIdBarVe']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrIdBarVe)%%>', html_attr($row['VcrIdBarVe']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdBarVe)%%>', urlencode($urow['VcrIdBarVe']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrIdCom)%%>', safe_html($urow['VcrIdCom']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrIdCom)%%>', html_attr($row['VcrIdCom']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdCom)%%>', urlencode($urow['VcrIdCom']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrIdCorr)%%>', safe_html($urow['VcrIdCorr']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrIdCorr)%%>', html_attr($row['VcrIdCorr']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdCorr)%%>', urlencode($urow['VcrIdCorr']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrLon)%%>', safe_html($urow['VcrLon']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrLon)%%>', html_attr($row['VcrLon']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrLon)%%>', urlencode($urow['VcrLon']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrLat)%%>', safe_html($urow['VcrLat']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrLat)%%>', html_attr($row['VcrLat']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrLat)%%>', urlencode($urow['VcrLat']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrIdMot)%%>', safe_html($urow['VcrIdMot']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrIdMot)%%>', html_attr($row['VcrIdMot']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdMot)%%>', urlencode($urow['VcrIdMot']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrIdFen)%%>', safe_html($urow['VcrIdFen']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrIdFen)%%>', html_attr($row['VcrIdFen']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdFen)%%>', urlencode($urow['VcrIdFen']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrIdCar)%%>', safe_html($urow['VcrIdCar']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrIdCar)%%>', html_attr($row['VcrIdCar']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdCar)%%>', urlencode($urow['VcrIdCar']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrAyuHum)%%>', safe_html($urow['VcrAyuHum']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrAyuHum)%%>', html_attr($row['VcrAyuHum']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrAyuHum)%%>', urlencode($urow['VcrAyuHum']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrPerHer)%%>', safe_html($urow['VcrPerHer']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrPerHer)%%>', html_attr($row['VcrPerHer']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrPerHer)%%>', urlencode($urow['VcrPerHer']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrPerFall)%%>', safe_html($urow['VcrPerFall']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrPerFall)%%>', html_attr($row['VcrPerFall']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrPerFall)%%>', urlencode($urow['VcrPerFall']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrTraCas)%%>', safe_html($urow['VcrTraCas']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrTraCas)%%>', html_attr($row['VcrTraCas']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrTraCas)%%>', urlencode($urow['VcrTraCas']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrCop)%%>', safe_html($urow['VcrCop']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrCop)%%>', html_attr($row['VcrCop']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrCop)%%>', urlencode($urow['VcrCop']), $templateCode);
		if($dvprint || (!$AllowUpdate && !$AllowInsert)) {
			$templateCode = str_replace('<%%VALUE(VcrEstTra)%%>', safe_html($urow['VcrEstTra']), $templateCode);
		} else {
			$templateCode = str_replace('<%%VALUE(VcrEstTra)%%>', safe_html($urow['VcrEstTra'], true), $templateCode);
		}
		$templateCode = str_replace('<%%URLVALUE(VcrEstTra)%%>', urlencode($urow['VcrEstTra']), $templateCode);
		if($dvprint || (!$AllowUpdate && !$AllowInsert)) {
			$templateCode = str_replace('<%%VALUE(VcrObsHis)%%>', safe_html($urow['VcrObsHis']), $templateCode);
		} else {
			$templateCode = str_replace('<%%VALUE(VcrObsHis)%%>', safe_html($urow['VcrObsHis'], true), $templateCode);
		}
		$templateCode = str_replace('<%%URLVALUE(VcrObsHis)%%>', urlencode($urow['VcrObsHis']), $templateCode);
		if($dvprint || (!$AllowUpdate && !$AllowInsert)) {
			$templateCode = str_replace('<%%VALUE(VcrUbiInf)%%>', safe_html($urow['VcrUbiInf']), $templateCode);
		} else {
			$templateCode = str_replace('<%%VALUE(VcrUbiInf)%%>', safe_html($urow['VcrUbiInf'], true), $templateCode);
		}
		$templateCode = str_replace('<%%URLVALUE(VcrUbiInf)%%>', urlencode($urow['VcrUbiInf']), $templateCode);
		if($dvprint || (!$AllowUpdate && !$AllowInsert)) {
			$templateCode = str_replace('<%%VALUE(VcrResInf)%%>', safe_html($urow['VcrResInf']), $templateCode);
		} else {
			$templateCode = str_replace('<%%VALUE(VcrResInf)%%>', safe_html($urow['VcrResInf'], true), $templateCode);
		}
		$templateCode = str_replace('<%%URLVALUE(VcrResInf)%%>', urlencode($urow['VcrResInf']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrIdTra1)%%>', safe_html($urow['VcrIdTra1']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrIdTra1)%%>', html_attr($row['VcrIdTra1']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdTra1)%%>', urlencode($urow['VcrIdTra1']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrRadTra1)%%>', safe_html($urow['VcrRadTra1']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrRadTra1)%%>', html_attr($row['VcrRadTra1']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrRadTra1)%%>', urlencode($urow['VcrRadTra1']), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrFecTra1)%%>', app_datetime($row['VcrFecTra1']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrFecTra1)%%>', urlencode(app_datetime($urow['VcrFecTra1'])), $templateCode);
		if($dvprint || (!$AllowUpdate && !$AllowInsert)) {
			$templateCode = str_replace('<%%VALUE(VcrResTra1)%%>', safe_html($urow['VcrResTra1']), $templateCode);
		} else {
			$templateCode = str_replace('<%%VALUE(VcrResTra1)%%>', safe_html($urow['VcrResTra1'], true), $templateCode);
		}
		$templateCode = str_replace('<%%URLVALUE(VcrResTra1)%%>', urlencode($urow['VcrResTra1']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrIdTra2)%%>', safe_html($urow['VcrIdTra2']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrIdTra2)%%>', html_attr($row['VcrIdTra2']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdTra2)%%>', urlencode($urow['VcrIdTra2']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrRadTra2)%%>', safe_html($urow['VcrRadTra2']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrRadTra2)%%>', html_attr($row['VcrRadTra2']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrRadTra2)%%>', urlencode($urow['VcrRadTra2']), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrFecTra2)%%>', app_datetime($row['VcrFecTra2']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrFecTra2)%%>', urlencode(app_datetime($urow['VcrFecTra2'])), $templateCode);
		if($dvprint || (!$AllowUpdate && !$AllowInsert)) {
			$templateCode = str_replace('<%%VALUE(VcrResTra2)%%>', safe_html($urow['VcrResTra2']), $templateCode);
		} else {
			$templateCode = str_replace('<%%VALUE(VcrResTra2)%%>', safe_html($urow['VcrResTra2'], true), $templateCode);
		}
		$templateCode = str_replace('<%%URLVALUE(VcrResTra2)%%>', urlencode($urow['VcrResTra2']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrIdTra3)%%>', safe_html($urow['VcrIdTra3']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrIdTra3)%%>', html_attr($row['VcrIdTra3']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdTra3)%%>', urlencode($urow['VcrIdTra3']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrRadTra3)%%>', safe_html($urow['VcrRadTra3']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrRadTra3)%%>', html_attr($row['VcrRadTra3']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrRadTra3)%%>', urlencode($urow['VcrRadTra3']), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrFecTra3)%%>', app_datetime($row['VcrFecTra3']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrFecTra3)%%>', urlencode(app_datetime($urow['VcrFecTra3'])), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrResTra3)%%>', safe_html($urow['VcrResTra3']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrResTra3)%%>', html_attr($row['VcrResTra3']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrResTra3)%%>', urlencode($urow['VcrResTra3']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrIdTra4)%%>', safe_html($urow['VcrIdTra4']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrIdTra4)%%>', html_attr($row['VcrIdTra4']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdTra4)%%>', urlencode($urow['VcrIdTra4']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrRadTra4)%%>', safe_html($urow['VcrRadTra4']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrRadTra4)%%>', html_attr($row['VcrRadTra4']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrRadTra4)%%>', urlencode($urow['VcrRadTra4']), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrFecTra4)%%>', app_datetime($row['VcrFecTra4']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrFecTra4)%%>', urlencode(app_datetime($urow['VcrFecTra4'])), $templateCode);
		if($dvprint || (!$AllowUpdate && !$AllowInsert)) {
			$templateCode = str_replace('<%%VALUE(VcrResTra4)%%>', safe_html($urow['VcrResTra4']), $templateCode);
		} else {
			$templateCode = str_replace('<%%VALUE(VcrResTra4)%%>', safe_html($urow['VcrResTra4'], true), $templateCode);
		}
		$templateCode = str_replace('<%%URLVALUE(VcrResTra4)%%>', urlencode($urow['VcrResTra4']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrIdTra5)%%>', safe_html($urow['VcrIdTra5']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrIdTra5)%%>', html_attr($row['VcrIdTra5']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdTra5)%%>', urlencode($urow['VcrIdTra5']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrRadTra5)%%>', safe_html($urow['VcrRadTra5']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrRadTra5)%%>', html_attr($row['VcrRadTra5']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrRadTra5)%%>', urlencode($urow['VcrRadTra5']), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrFecTra5)%%>', app_datetime($row['VcrFecTra5']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrFecTra5)%%>', urlencode(app_datetime($urow['VcrFecTra5'])), $templateCode);
		if($dvprint || (!$AllowUpdate && !$AllowInsert)) {
			$templateCode = str_replace('<%%VALUE(VcrResTra5)%%>', safe_html($urow['VcrResTra5']), $templateCode);
		} else {
			$templateCode = str_replace('<%%VALUE(VcrResTra5)%%>', safe_html($urow['VcrResTra5'], true), $templateCode);
		}
		$templateCode = str_replace('<%%URLVALUE(VcrResTra5)%%>', urlencode($urow['VcrResTra5']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrIdTra6)%%>', safe_html($urow['VcrIdTra6']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrIdTra6)%%>', html_attr($row['VcrIdTra6']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdTra6)%%>', urlencode($urow['VcrIdTra6']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrRadTra6)%%>', safe_html($urow['VcrRadTra6']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrRadTra6)%%>', html_attr($row['VcrRadTra6']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrRadTra6)%%>', urlencode($urow['VcrRadTra6']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrIdTra7)%%>', safe_html($urow['VcrIdTra7']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrIdTra7)%%>', html_attr($row['VcrIdTra7']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdTra7)%%>', urlencode($urow['VcrIdTra7']), $templateCode);
		if($dvprint || (!$AllowUpdate && !$AllowInsert)) {
			$templateCode = str_replace('<%%VALUE(VcrRadTra7)%%>', safe_html($urow['VcrRadTra7']), $templateCode);
		} else {
			$templateCode = str_replace('<%%VALUE(VcrRadTra7)%%>', safe_html($urow['VcrRadTra7'], true), $templateCode);
		}
		$templateCode = str_replace('<%%URLVALUE(VcrRadTra7)%%>', urlencode($urow['VcrRadTra7']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrIdTra8)%%>', safe_html($urow['VcrIdTra8']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrIdTra8)%%>', html_attr($row['VcrIdTra8']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdTra8)%%>', urlencode($urow['VcrIdTra8']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(VcrRadTra8)%%>', safe_html($urow['VcrRadTra8']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(VcrRadTra8)%%>', html_attr($row['VcrRadTra8']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrRadTra8)%%>', urlencode($urow['VcrRadTra8']), $templateCode);
	} else {
		$templateCode = str_replace('<%%VALUE(VcrId)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrId)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrCodHis)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrCodHis)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(Vcrano)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(Vcrano)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrIdSerP)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdSerP)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrIdSol)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdSol)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrRadSol)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrRadSol)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrFecSol)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrFecSol)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrRadRes)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrRadRes)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrFecRad)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrFecRad)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrDiaResp)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrDiaResp)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrIdRie)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdRie)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrEntSol)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrEntSol)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrNomAti)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrNomAti)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrNoIde)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrNoIde)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrCel)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrCel)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrCodForm)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrCodForm)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrFecVis)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrFecVis)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrDir)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrDir)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrIdBarVe)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdBarVe)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrIdCom)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdCom)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrIdCorr)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdCorr)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrLon)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrLon)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrLat)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrLat)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrIdMot)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdMot)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrIdFen)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdFen)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrIdCar)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdCar)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrAyuHum)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrAyuHum)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrPerHer)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrPerHer)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrPerFall)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrPerFall)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrTraCas)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrTraCas)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrCop)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrCop)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrEstTra)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrEstTra)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrObsHis)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrObsHis)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrUbiInf)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrUbiInf)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrResInf)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrResInf)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrIdTra1)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdTra1)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrRadTra1)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrRadTra1)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrFecTra1)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrFecTra1)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrResTra1)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrResTra1)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrIdTra2)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdTra2)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrRadTra2)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrRadTra2)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrFecTra2)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrFecTra2)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrResTra2)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrResTra2)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrIdTra3)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdTra3)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrRadTra3)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrRadTra3)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrFecTra3)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrFecTra3)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrResTra3)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrResTra3)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrIdTra4)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdTra4)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrRadTra4)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrRadTra4)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrFecTra4)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrFecTra4)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrResTra4)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrResTra4)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrIdTra5)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdTra5)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrRadTra5)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrRadTra5)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrFecTra5)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrFecTra5)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrResTra5)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrResTra5)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrIdTra6)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdTra6)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrRadTra6)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrRadTra6)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrIdTra7)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdTra7)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrRadTra7)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrRadTra7)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrIdTra8)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrIdTra8)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(VcrRadTra8)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(VcrRadTra8)%%>', urlencode(''), $templateCode);
	}

	// process translations
	$templateCode = parseTemplate($templateCode);

	// clear scrap
	$templateCode = str_replace('<%%', '<!-- ', $templateCode);
	$templateCode = str_replace('%%>', ' -->', $templateCode);

	// hide links to inaccessible tables
	if(Request::val('dvprint_x') == '') {
		$templateCode .= "\n\n<script>\$j(function() {\n";
		$arrTables = getTableList();
		foreach($arrTables as $name => $caption) {
			$templateCode .= "\t\$j('#{$name}_link').removeClass('hidden');\n";
			$templateCode .= "\t\$j('#xs_{$name}_link').removeClass('hidden');\n";
		}

		$templateCode .= $jsReadOnly;
		$templateCode .= $jsEditable;

		if(!$selected_id) {
		}

		$templateCode.="\n});</script>\n";
	}

	// ajaxed auto-fill fields
	$templateCode .= '<script>';
	$templateCode .= '$j(function() {';


	$templateCode.="});";
	$templateCode.="</script>";
	$templateCode .= $lookups;

	// handle enforced parent values for read-only lookup fields
	$filterField = Request::val('FilterField');
	$filterOperator = Request::val('FilterOperator');
	$filterValue = Request::val('FilterValue');

	// don't include blank images in lightbox gallery
	$templateCode = preg_replace('/blank.gif" data-lightbox=".*?"/', 'blank.gif"', $templateCode);

	// don't display empty email links
	$templateCode=preg_replace('/<a .*?href="mailto:".*?<\/a>/', '', $templateCode);

	/* default field values */
	$rdata = $jdata = get_defaults('historico_vt');
	if($selected_id) {
		$jdata = get_joined_record('historico_vt', $selected_id);
		if($jdata === false) $jdata = get_defaults('historico_vt');
		$rdata = $row;
	}
	$templateCode .= loadView('historico_vt-ajax-cache', ['rdata' => $rdata, 'jdata' => $jdata]);

	// hook: historico_vt_dv
	if(function_exists('historico_vt_dv')) {
		$args = [];
		historico_vt_dv(($selected_id ? $selected_id : FALSE), getMemberInfo(), $templateCode, $args);
	}

	return $templateCode;
}